!function(e){function t(t){for(var n,r,l=t[0],s=t[1],c=t[2],d=0,u=[];d<l.length;d++)r=l[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&u.push(o[r][0]),o[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(p&&p(t);u.length;)u.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,l=1;l<a.length;l++){var s=a[l];0!==o[s]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},o={2:0},i=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/public/js";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var p=s;i.push([202,0,3]),a()}({1:function(e,t,a){"use strict";a.d(t,"c",(function(){return h})),a.d(t,"b",(function(){return f})),a.d(t,"a",(function(){return g}));var n=a(7),o=a.n(n),i=a(2),r=a.n(i);const[l,s,c,p]=[0,1,2,3];let d=l,u={notReady:!0};function h(e){let t,a="en";d!==c?(d=s,e.lang&&(a=e.lang),t=`/public/lang/${a}.json`,"en"!==a&&"integration"===e.env&&(t=`${e.url_prefix}${t}`),o.a.get(t).then(e=>{u=e.data,d=c,console.log("%s loaded",a)}).catch(e=>{d=p,r.a.error(`Failed to load language: ${a}`),console.error("language load failed: %o",e)})):r.a.warning("language already loaded")}function m(e,t){return d===l?"not loaded":d!==c?`${d===s?`loading(${e}:${t})`:`failed(${e}:${t})`}`:u[e]?t?u[e][t]?u[e][t]:null:u[e]:null}function f(e,t=!1){if("string"!=typeof e)return null;let[a,n]=e.split(":");return t?function(e,t){return new Promise((a,n)=>{d==s?(console.log("wait started for language to load: '%s:%s'",e,t),function e(t,n,o,i=8,r=0){return d!==s?(console.log("Language loaded at wait count: %s",r),void a(m(t,n))):r<=i?void setTimeout(()=>e(t,n,o,i,r+1),o):(console.log("timeout waiting for language to load: '%s:%s'",t,n),void a("timeout"))}(e,t,250)):a(m(e,t))})}(a,n):m(a,n)}function g(e,...t){const a=t.map(e=>{let t=f(e);return t||e});return e.reduce((e,t,n)=>`${e}${t}${a[n]||""}`,"")}},108:function(e,t,a){const n=a(173).sprintf,o=["acq","profile"],i=["xxx",...o],r={acq:["xxx","welcome","overview","quick","bookmark","search","audio","accounts","profile","video","email","tech","contact"],profile:["xxx","email","topicMgt"]};function l(e,t){if(r[e])return r[e].indexOf(t);throw new Error(`unexpected bookId: ${e}`)}function s(){return{sourceId:99,keyLength:7}}function c(e){const t={sourceId:99,keyLength:7};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function p(e=location.pathname){let t={sid:99,bid:0,uid:0,qid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[0]),-1===t.bid)return-1;if(t.uid=l(a[0],a[1]),-1===t.bid)return-1;let o=n("%02s%02s%03s",t.sid,t.bid,t.uid);return parseInt(o,10)}function d(e){let{pid:t,pageKey:a}=c(e),n=a.toString(10),o={error:0,message:"ok",sid:99,bookId:"",uid:0,pid:t-1};if(7!==n.length)return o.error=!0,o.message=`Integer portion of key should have a length of 7, key is: ${n}`,o;let r=parseInt(n.substr(2,2),10);return o.bookId=i[r],o.uid=parseInt(n.substr(4,3),10)-1,o}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getBooks:function(){return o},getSourceId:function(){return 99},getKeyInfo:s,parseKey:c,getUnitId:l,genPageKey:p,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=p(t)),n+a},decodeKey:d,getUrl:function(e){let t=d(e),a="invalid";return t.error?"/invalid/key/":(r[t.bookId]&&(a=r[t.bookId][t.uid+1]),`/${t.bookId}/${a}/`)},describeKey:function(e){let t=d(e);if(t.error)return{key:e,error:!0,source:"www"};let a={key:e,source:"www",book:t.bookId,unit:r[t.bookId][t.uid]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},109:function(e,t,a){const n=a(174).sprintf,o=["preface","text","workbook","manual","acq"],i=["xxx",...o],r={acq:["xxx","welcome","acim","web","raj"],preface:["xxx","preface"],text:["xxx","chap0100","chap0101","chap0102","chap0200","chap0201","chap0202","chap0203","chap0204","chap0205","chap0300","chap0301","chap0302","chap0303","chap0304","chap0305","chap0306","chap0307","chap0308","chap0400","chap0401","chap0402","chap0403","chap0404","chap0405","chap0406","chap0407","chap0408","chap0500","chap0501","chap0502","chap0503","chap0504","chap0505","chap0506","chap0507","chap0508","chap0600","chap0601","chap0602","chap0603","chap0604","chap0700","chap0701","chap0702","chap0703","chap0704","chap0705","chap0706","chap0707","chap0708","chap0709","chap0710","chap0711","chap0800","chap0801","chap0802","chap0803","chap0804","chap0805","chap0806","chap0807","chap0808","chap0809","chap0810","chap0900","chap0901","chap0902","chap0903","chap0904","chap0905","chap0906","chap0907","chap0908","chap0909","chap0910","chap1000","chap1001","chap1002","chap1003","chap1004","chap1005","chap1006","chap1007","chap1100","chap1101","chap1102","chap1103","chap1104","chap1105","chap1106","chap1107","chap1108","chap1109","chap1200","chap1201","chap1202","chap1203","chap1204","chap1205","chap1206","chap1300","chap1301","chap1302","chap1303","chap1304","chap1305","chap1306","chap1307","chap1308","chap1400","chap1401","chap1402","chap1403","chap1404","chap1405","chap1406","chap1500","chap1501","chap1502","chap1503","chap1504","chap1505","chap1506","chap1507","chap1508","chap1509","chap1510","chap1600","chap1601","chap1602","chap1603","chap1604","chap1605","chap1606","chap1607","chap1700","chap1701","chap1702","chap1703","chap1704","chap1705","chap1706","chap1707","chap1708","chap1800","chap1801","chap1802","chap1803","chap1804","chap1805","chap1806","chap1807","chap1808","chap1809","chap1810","chap1900","chap1901","chap1902","chap1903","chap1904","chap1905","chap1906","chap1907","chap1908","chap1909","chap1910","chap1911","chap2000","chap2001","chap2002","chap2003","chap2004","chap2005","chap2006","chap2007","chap2008","chap2100","chap2101","chap2102","chap2103","chap2104","chap2105","chap2106","chap2107","chap2108","chap2200","chap2201","chap2202","chap2203","chap2204","chap2205","chap2206","chap2300","chap2301","chap2302","chap2303","chap2304","chap2400","chap2401","chap2402","chap2403","chap2404","chap2405","chap2406","chap2407","chap2500","chap2501","chap2502","chap2503","chap2504","chap2505","chap2506","chap2507","chap2508","chap2509","chap2600","chap2601","chap2602","chap2603","chap2604","chap2605","chap2606","chap2607","chap2608","chap2609","chap2610","chap2700","chap2701","chap2702","chap2703","chap2704","chap2705","chap2706","chap2707","chap2708","chap2800","chap2801","chap2802","chap2803","chap2804","chap2805","chap2806","chap2807","chap2900","chap2901","chap2902","chap2903","chap2904","chap2905","chap2906","chap2907","chap2908","chap2909","chap3000","chap3001","chap3002","chap3003","chap3004","chap3005","chap3006","chap3007","chap3008","chap3100","chap3101","chap3102","chap3103","chap3104","chap3105","chap3106","chap3107"],workbook:["xxx","introp1","l001","l002","l003","l004","l005","l006","l007","l008","l009","l010","l011","l012","l013","l014","l015","l016","l017","l018","l019","l020","l021","l022","l023","l024","l025","l026","l027","l028","l029","l030","l031","l032","l033","l034","l035","l036","l037","l038","l039","l040","l041","l042","l043","l044","l045","l046","l047","l048","l049","l050","review1","l051","l052","l053","l054","l055","l056","l057","l058","l059","l060","l061","l062","l063","l064","l065","l066","l067","l068","l069","l070","l071","l072","l073","l074","l075","l076","l077","l078","l079","l080","review2","l081","l082","l083","l084","l085","l086","l087","l088","l089","l090","l091","l092","l093","l094","l095","l096","l097","l098","l099","l100","l101","l102","l103","l104","l105","l106","l107","l108","l109","l110","review3","l111","l112","l113","l114","l115","l116","l117","l118","l119","l120","l121","l122","l123","l124","l125","l126","l127","l128","l129","l130","l131","l132","l133","l134","l135","l136","l137","l138","l139","l140","review4","l141","l142","l143","l144","l145","l146","l147","l148","l149","l150","l151","l152","l153","l154","l155","l156","l157","l158","l159","l160","l161","l162","l163","l164","l165","l166","l167","l168","l169","l170","review5","l171","l172","l173","l174","l175","l176","l177","l178","l179","l180","intro181","l181","l182","l183","l184","l185","l186","l187","l188","l189","l190","l191","l192","l193","l194","l195","l196","l197","l198","l199","l200","review6","l201","l202","l203","l204","l205","l206","l207","l208","l209","l210","l211","l212","l213","l214","l215","l216","l217","l218","l219","l220","introp2","forgiveness","l221","l222","l223","l224","l225","l226","l227","l228","l229","l230","salvation","l231","l232","l233","l234","l235","l236","l237","l238","l239","l240","world","l241","l242","l243","l244","l245","l246","l247","l248","l249","l250","sin","l251","l252","l253","l254","l255","l256","l257","l258","l259","l260","body","l261","l262","l263","l264","l265","l266","l267","l268","l269","l270","christ","l271","l272","l273","l274","l275","l276","l277","l278","l279","l280","holyspirit","l281","l282","l283","l284","l285","l286","l287","l288","l289","l290","realworld","l291","l292","l293","l294","l295","l296","l297","l298","l299","l300","secondcoming","l301","l302","l303","l304","l305","l306","l307","l308","l309","l310","lastjudgement","l311","l312","l313","l314","l315","l316","l317","l318","l319","l320","creation","l321","l322","l323","l324","l325","l326","l327","l328","l329","l330","ego","l331","l332","l333","l334","l335","l336","l337","l338","l339","l340","miracle","l341","l342","l343","l344","l345","l346","l347","l348","l349","l350","whatami","l351","l352","l353","l354","l355","l356","l357","l358","l359","l360","final","l361","epilog"],manual:["xxx","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","chap13","chap14","chap15","chap16","chap17","chap18","chap19","chap20","chap21","chap22","chap23","chap24","chap25","chap26","chap27","chap28","chap29","chap30","chap31"]};function l(){return{sourceId:12,keyLength:7}}function s(e){const t={sourceId:12,keyLength:7};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function c(e=location.pathname){let t={sid:12,bid:0,uid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=function(e,t,a,n,o){if(o&&(n=o),r[a])return r[a].indexOf(n);throw new Error(`unexpected bookId: ${a}`)}(...a),-1===t.uid)return-1;let o=n("%02s%01s%04s",t.sid,t.bid,t.uid);return parseInt(o,10)}function p(e){let{pid:t,pageKey:a}=s(e),n=a.toString(10),o={error:!1,message:"ok",sid:0,bookId:"",uid:0,pid:t-1};if(7!==n.length)return o.error=!0,o.message=`Integer portion of key should have a length of 7, key is: ${n}`,o;if(o.sid=parseInt(n.substr(0,2),10),12!==o.sid)return o.error=!0,o.message=`Invalid sourceId: ${o.sid}, expecting: 12`,o;let r=parseInt(n.substr(2,1),10);return o.bookId=i[r],o.uid=parseInt(n.substr(3,4),10),o}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getBooks:function(){return o},getSourceId:function(){return 12},getKeyInfo:l,parseKey:s,genPageKey:c,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=c(t)),n+a},decodeKey:p,getUrl:function(e,t=!1){let a=p(e),n="invalid";if(a.error)return"/invalid/key/";if(r[a.bookId]&&(n=r[a.bookId][a.uid],"text"===a.bookId)){let e=n.substr(4,2);n=`${e}/${n}`}return t?`/t/acim/${a.bookId}/${n}/`:`/${a.bookId}/${n}/`},describeKey:function(e){let t=p(e);if(t.error)return{key:e,error:!0,source:"acim"};let a={key:e,source:"acim",book:t.bookId,unit:r[t.bookId][t.uid]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},11:function(e,t,a){"use strict";var n=a(78),o=a.n(n),i=a(2),r=a.n(i),l=a(1),s=new Map;function c(e){var t,a=new o.a(e);return(t=a).on("success",e=>{e.text.indexOf("tocbook")>-1?($(".toc.modal > .message").html(`<p>${Object(l.b)("clip:url")}</p>`),setTimeout(()=>{$(".toc.modal > .message > p").remove()},2e3)):r.a.info(Object(l.b)("clip:link")),e.clearSelection()}),t.on("error",()=>{r.a.info(Object(l.b)("error:e3"))}),a}t.a={register:function(e){let t=s.get(e);return t||(t=c(e),s.set(e,t)),t},destroy:function(e){let t=s.get(e);t&&(t.destroy(),s.delete(e))}}},110:function(e,t,a){const n=a(175).sprintf,o=["text","workbook","manual","acq"],i=["xxx",...o],r={acq:["xxx","welcome","acim","cims","formats","contact","timers"],text:["xxx","forward","intro","chap0101","chap0102","chap0201","chap0202","chap0203","chap0204","chap0205","chap0206","chap0301","chap0302","chap0303","chap0304","chap0305","chap0306","chap0307","chap0308","chap0309","chap0401","chap0402","chap0403","chap0404","chap0405","chap0406","chap0407","chap0408","chap0409","chap0501","chap0502","chap0503","chap0504","chap0505","chap0506","chap0507","chap0508","chap0509","chap0601","chap0602","chap0603","chap0604","chap0605","chap0701","chap0702","chap0703","chap0704","chap0705","chap0706","chap0707","chap0708","chap0709","chap0710","chap0711","chap0712","chap0801","chap0802","chap0803","chap0804","chap0805","chap0806","chap0807","chap0808","chap0809","chap0810","chap0811","chap0901","chap0902","chap0903","chap0904","chap0905","chap0906","chap0907","chap0908","chap0909","chap0910","chap0911","chap1001","chap1002","chap1003","chap1004","chap1005","chap1006","chap1007","chap1008","chap1101","chap1102","chap1103","chap1104","chap1105","chap1106","chap1107","chap1108","chap1109","chap1110","chap1201","chap1202","chap1203","chap1204","chap1205","chap1206","chap1207","chap1301","chap1302","chap1303","chap1304","chap1305","chap1306","chap1307","chap1308","chap1309","chap1401","chap1402","chap1403","chap1404","chap1405","chap1406","chap1407","chap1501","chap1502","chap1503","chap1504","chap1505","chap1506","chap1507","chap1508","chap1509","chap1510","chap1511","chap1601","chap1602","chap1603","chap1604","chap1605","chap1606","chap1607","chap1608","chap1701","chap1702","chap1703","chap1704","chap1705","chap1706","chap1707","chap1708","chap1709","chap1801","chap1802","chap1803","chap1804","chap1805","chap1806","chap1807","chap1808","chap1809","chap1810","chap1811","chap1901","chap1902","chap1903","chap1904","chap1905","chap2001","chap2002","chap2003","chap2004","chap2005","chap2006","chap2007","chap2008","chap2009","chap2101","chap2102","chap2103","chap2104","chap2105","chap2106","chap2107","chap2108","chap2109","chap2201","chap2202","chap2203","chap2204","chap2205","chap2206","chap2207","chap2301","chap2302","chap2303","chap2304","chap2305","chap2401","chap2402","chap2403","chap2404","chap2405","chap2406","chap2407","chap2408","chap2501","chap2502","chap2503","chap2504","chap2505","chap2506","chap2507","chap2508","chap2509","chap2510","chap2601","chap2602","chap2603","chap2604","chap2605","chap2606","chap2607","chap2608","chap2609","chap2610","chap2611","chap2701","chap2702","chap2703","chap2704","chap2705","chap2706","chap2707","chap2708","chap2709","chap2801","chap2802","chap2803","chap2804","chap2805","chap2806","chap2807","chap2808","chap2901","chap2902","chap2903","chap2904","chap2905","chap2906","chap2907","chap2908","chap2909","chap2910","chap3001","chap3002","chap3003","chap3004","chap3005","chap3006","chap3007","chap3008","chap3009","chap3101","chap3102","chap3103","chap3104","chap3105","chap3106","chap3107","chap3108"],workbook:["xxx","introp1","l001","l002","l003","l004","l005","l006","l007","l008","l009","l010","l011","l012","l013","l014","l015","l016","l017","l018","l019","l020","l021","l022","l023","l024","l025","l026","l027","l028","l029","l030","l031","l032","l033","l034","l035","l036","l037","l038","l039","l040","l041","l042","l043","l044","l045","l046","l047","l048","l049","l050","review1","l051","l052","l053","l054","l055","l056","l057","l058","l059","l060","l061","l062","l063","l064","l065","l066","l067","l068","l069","l070","l071","l072","l073","l074","l075","l076","l077","l078","l079","l080","review2","l081","l082","l083","l084","l085","l086","l087","l088","l089","l090","l091","l092","l093","l094","l095","l096","l097","l098","l099","l100","l101","l102","l103","l104","l105","l106","l107","l108","l109","l110","review3","l111","l112","l113","l114","l115","l116","l117","l118","l119","l120","l121","l122","l123","l124","l125","l126","l127","l128","l129","l130","l131","l132","l133","l134","l135","l136","l137","l138","l139","l140","review4","l141","l142","l143","l144","l145","l146","l147","l148","l149","l150","l151","l152","l153","l154","l155","l156","l157","l158","l159","l160","l161","l162","l163","l164","l165","l166","l167","l168","l169","l170","review5","l171","l172","l173","l174","l175","l176","l177","l178","l179","l180","intro181","l181","l182","l183","l184","l185","l186","l187","l188","l189","l190","l191","l192","l193","l194","l195","l196","l197","l198","l199","l200","review6","l201","l202","l203","l204","l205","l206","l207","l208","l209","l210","l211","l212","l213","l214","l215","l216","l217","l218","l219","l220","introp2","forgiveness","l221","l222","l223","l224","l225","l226","l227","l228","l229","l230","salvation","l231","l232","l233","l234","l235","l236","l237","l238","l239","l240","world","l241","l242","l243","l244","l245","l246","l247","l248","l249","l250","sin","l251","l252","l253","l254","l255","l256","l257","l258","l259","l260","body","l261","l262","l263","l264","l265","l266","l267","l268","l269","l270","christ","l271","l272","l273","l274","l275","l276","l277","l278","l279","l280","holyspirit","l281","l282","l283","l284","l285","l286","l287","l288","l289","l290","realworld","l291","l292","l293","l294","l295","l296","l297","l298","l299","l300","secondcoming","l301","l302","l303","l304","l305","l306","l307","l308","l309","l310","lastjudgement","l311","l312","l313","l314","l315","l316","l317","l318","l319","l320","creation","l321","l322","l323","l324","l325","l326","l327","l328","l329","l330","ego","l331","l332","l333","l334","l335","l336","l337","l338","l339","l340","miracle","l341","l342","l343","l344","l345","l346","l347","l348","l349","l350","whatami","l351","l352","l353","l354","l355","l356","l357","l358","l359","l360","final","l361","l362","l363","l364","l365","epilog"],manual:["xxx","intro","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","chap13","chap14","chap15","chap16","chap17","chap18","chap19","chap20","chap21","chap22","chap23","chap24","chap25","chap26","chap27","chap28","chap29"]};function l(e,t,a,n,o){if(o&&(n=o),r[a])return r[a].indexOf(n);throw new Error(`unexpected bookId: ${a}`)}function s(){return{sourceId:15,keyLength:7}}function c(e){const t={sourceId:15,keyLength:7};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function p(e=location.pathname){let t={sid:15,bid:0,uid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=l(...a),-1===t.uid)return-1;let o=n("%02s%01s%04s",t.sid,t.bid,t.uid);return parseInt(o,10)}function d(e){let{pid:t,pageKey:a}=c(e),n=a.toString(10),o={error:!1,message:"ok",sid:0,bookId:"",uid:0,pid:t-1};if(7!==n.length)return o.error=!0,o.message=`Integer portion of key should have a length of 7, key is: ${n}`,o;if(o.sid=parseInt(n.substr(0,2),10),15!==o.sid)return o.error=!0,o.message=`Invalid sourceId: ${o.sid}, expecting: 15`,o;let r=parseInt(n.substr(2,1),10);return o.bookId=i[r],o.uid=parseInt(n.substr(3,4),10),o}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getBooks:function(){return o},getSourceId:function(){return 15},getKeyInfo:s,parseKey:c,getUnitId:l,genPageKey:p,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=p(t)),n+a},decodeKey:d,getUrl:function(e,t=!1){let a=d(e),n="invalid";if(a.error)return"/invalid/key/";if(r[a.bookId]&&(n=r[a.bookId][a.uid],"text"===a.bookId)){let e=n.substr(4,2);n=`${e}/${n}`}return t?`/t/acimoe/${a.bookId}/${n}/`:`/${a.bookId}/${n}/`},describeKey:function(e){let t=d(e);if(t.error)return{key:e,error:!0,source:"acimoe"};let a={key:e,source:"acimoe",book:t.bookId,unit:r[t.bookId][t.uid]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},111:function(e,t,a){const n=a(176).sprintf,o=["course","treatise","dialog","acq"],i=["xxx",...o],r={course:["xxx","intro","prelude","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","chap13","chap14","chap15","chap16","chap17","chap18","chap19","chap20","chap21","chap22","chap23","chap24","chap25","chap26","chap27","chap28","chap29","chap30","chap31","chap32","learning1"],treatise:["xxx","t1chap01","t1chap02","t1chap03","t1chap04","t1chap05","t1chap06","t1chap07","t1chap08","t1chap09","t1chap10","t2chap01","t2chap02","t2chap03","t2chap04","t2chap05","t2chap06","t2chap07","t2chap08","t2chap09","t2chap10","t2chap11","t2chap12","t2chap13","t3chap01","t3chap02","t3chap03","t3chap04","t3chap05","t3chap06","t3chap07","t3chap08","t3chap09","t3chap10","t3chap11","t3chap12","t3chap13","t3chap14","t3chap15","t3chap16","t3chap17","t3chap18","t3chap19","t3chap20","t3chap21","t3chap22","t4chap01","t4chap02","t4chap03","t4chap04","t4chap05","t4chap06","t4chap07","t4chap08","t4chap09","t4chap10","t4chap11","t4chap12","learning2"],dialog:["xxx","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","chap13","chap14","chap15","chap16","chap17","day01","day02","day03","day04","day05","day06","day07","day08","day09","day10","day11","day12","day13","day14","day15","day16","day17","day18","day19","day20","day21","day22","day23","day24","day25","day26","day27","day28","day29","day30","day31","day32","day33","day34","day35","day36","day37","day38","day39","day40","epilog","learning3","dialog"],acq:["xxx","welcome","book","access"]};function l(e,t){if(r[e])return r[e].indexOf(t);throw new Error(`unexpected bookId: ${e}`)}function s(){return{sourceId:14,keyLength:7}}function c(e){const t={sourceId:14,keyLength:7};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function p(e=location.pathname){let t={sid:14,bid:0,uid:0,qid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=l(a[2],a[3]),-1===t.bid)return-1;let o=n("%02s%02s%03s",t.sid,t.bid,t.uid);return parseInt(o,10)}function d(e,t=!0){let{pid:a,pageKey:n}=c(e),o=n.toString(10),r={error:0,message:"ok",sid:14,bookId:"",uid:0,pid:a-1};if(7!==o.length)return r.error=!0,r.message=`Integer portion of key should have a length of 7, key is: ${o}`,r;let l=parseInt(o.substr(2,2),10);return r.bookId=i[l],r.uid=t?parseInt(o.substr(4,3),10)-1:parseInt(o.substr(4,3),10),r}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getBooks:function(){return o},getSourceId:function(){return 14},getKeyInfo:s,parseKey:c,getUnitId:l,getUrl:function(e,t=!1){let a=d(e,!1),n="invalid";return a.error?"/invalid/key/":(r[a.bookId]&&(n=r[a.bookId][a.uid]),t?`/t/acol/${a.bookId}/${n}/`:`/${a.bookId}/${n}/`)},genPageKey:p,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=p(t)),n+a},decodeKey:d,describeKey:function(e){let t=d(e,!1);if(t.error)return{key:e,error:!0,source:"acol"};let a={key:e,source:"acol",book:t.bookId,unit:r[t.bookId][t.uid]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},112:function(e,t,a){const n=a(177).sprintf,o=["yaa","grad","sg2002","sg2003","sg2004","sg2005","sg2006","sg2007","sg2008","sg2009","sg2010","sg2011","sg2012","sg2013","sg2014","sg2015","sg2016","sg2017","sg2018","acq"],i=["xxx",...o],r={acq:["xxx","welcome","raj","download","web"],yaa:["xxx","acknowledgments","foreword","020782","020882","020982","021082","021182a","021182b","021282","021382","021482","021682","021782","021882a","021882b","021882c","021982","022082","022182a","022182b","022382a","022382b","022382c","022482","022582","022682a","022682b","022682c","022782","022882","030182a","030182b","030282","030382","030482a","030482b","030582a","030582b","030682a","030682b","030682c","030682d","030682e","030882","030982","031082a","031082b","031082c","031182","031382","031582","031982","032982","033082","042782","042882","042982","043082","050182","050282","050382","050782","050982","051082a","051082b","051082c","051182","051582","051782","052882","053082","060382","061082","061282","061482","061982","062182","afterword"],grad:["xxx","g000002","g000003","g010491","g010591","g011491","g011591","g011691","g011891","g012091","g012591","g012791","g020291","g020591","g020691","g021291","g021391","g021491","g022091","g022591","g030291","g030891","g031491","g031991","g032091","g032191","g032291","g032591","g032991"],sg2002:["xxx","061202","073102","080702","081402","082802","090402","091102","091802","092502","100202","101002","101702","102402","103102","110702","112102","120502","121202","121902"],sg2003:["xxx","010203","010903","011603","012303","020603","021303","022003","022703","030603","031303","032003","032703","040303","041003","042403","050103","051103","051803","052503","060103","060803","061503","062203","062903","070603","071303","072003","072703","080303","081003","081703","082403","083103","090703","091403","092103","092803","101203","101903","102603","110203","110903","111603","112303","120703","121403","122103"],sg2004:["xxx","011104","011804","012504","020104","020804","021504","022204","030704","031404","032804","040404","041104","041804","042504","050204","050904","051604","052304","053004","061304","062004","062704","071104","071804","072504","080104","080804","081504","082204","090504","091204","091904","092604","100304","101004","101704","102404","110704","112104","112804","120504","121204","121904"],sg2005:["xxx","010205","011605","012305","013005","021305","022005","030605","031305","032705","040305","041005","041705","042405","050105","050805","052205","060505","061205","061905","070305","071005","071705","072405","080705","081405","082105","082805","090405","091105","091805","100205","100905","101605","102305","110605","111305","112005","120405","121105","121805"],sg2006:["xxx","010806","011506","012206","012906","021206","022606","030406","031106","031906","040106","041506","042906","050606","052006","052706","060306","061006","061806","062406","070106","071506","073006","080506","081206","082006","090206","090906","092306","100706","101406","102106","102806","111106","111806","120206"],sg2007:["xxx","081807","082507","090907","091607","092207","100607","101407","102707","110307","111007","111807","120807","121607"],sg2008:["xxx","012008","012708","021008","021708","022408","030208","030908","032508","033008","040608","041308","042008","050408","051808","052508","060108","060808","061508","062208","070608","071308","072708","081708","083108","090708","091408","092108","100508","101908","102608","110208","110908","112308"],sg2009:["xxx","010309","011009","011709","012409","020709","022809","031409","032809","040409","041209","042509","050909","052409","053109","060709","061309","062009","071109","071809","072509","080109","080809","082909","090509","091209","091909","092709","101009","102409","103109","111409","112209","112809","120509","121909"],sg2010:["xxx","010210","011610","013010","020610","021310","030610","032010","032710","040310","041010","050110","051510","052910","060510","061210","061910","070310","071010","071710","072410","080710","082810","090410","091110","092510","100210","100910","101610","102310","110610","111310","112010","112710","120410","121810"],sg2011:["xxx","010111","010811","011511","012211","020511","021611","021911","031211","032011","032611","040311","040911","041611","042311","043011","050711","051411","052211","060411","061211","061811","062611","070911","071611","073011","080611","082011","082711","090311","091711","092411","100111","101511","102311","110511","111311","112611","120411","121111","122011"],sg2012:["xxx","010712","012212","020512","021212","021812","032412","033112","040812","041512","042212","042912","051212","052012","060312","061712","072212","072912","080412","081112","081812","082712","090812","091612","092312","093012","100812","101412","102112","110512","111212"],sg2013:["xxx","042713","050413","051113","052013","052813","060213","060913","062513","063013","070713","071413","072113","080413","081113","082513","090113","090813","091513","092313","100613","101513","102013","102713","110313","112413","122213","123013"],sg2014:["xxx","010614","011414","012814","020914","022414","030914","041314","061614","062914","091514"],sg2015:["xxx","041815","042515","050315","050915","051715","060715","061415","062115","062815","070515","071315","072115","080115","082315","091315","100215","102115","110115"],sg2016:["xxx","070316","071616","080216"],sg2017:["xxx","040817","041617","042317","043017","051217","060917","071117","072317","092317","100117","101717","120417"],sg2018:["xxx","013118","031118","081918","082918"]};function l(e,t){if(r[e])return r[e].indexOf(t);throw new Error(`unexpected bookId: ${e}`)}function s(){return{sourceId:13,keyLength:7}}function c(e){const t={sourceId:13,keyLength:7};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function p(e=location.pathname){let t={sid:13,bid:0,uid:0,qid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=l(a[2],a[3]),-1===t.bid)return-1;let o=n("%02s%02s%03s",t.sid,t.bid,t.uid);return parseInt(o,10)}function d(e){let{pid:t,pageKey:a}=c(e),n=a.toString(10),o={error:0,message:"ok",sid:13,bookId:"",uid:0,pid:t-1};if(7!==n.length)return o.error=!0,o.message=`Integer portion of key should have a length of 7, key is: ${n}`,o;let r=parseInt(n.substr(2,2),10);return o.bookId=i[r],o.uid=parseInt(n.substr(4,3),10)-1,o}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getBooks:function(){return o},getUrl:function(e,t=!1){let a=d(e),n="invalid";return a.error?"/invalid/key/":(r[a.bookId]&&(n=r[a.bookId][a.uid+1]),t?`/t/raj/${a.bookId}/${n}/`:`/${a.bookId}/${n}/`)},getSourceId:function(){return 13},getKeyInfo:s,parseKey:c,getUnitId:l,genPageKey:p,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=p(t)),n+a},decodeKey:d,describeKey:function(e){let t=d(e);if(t.error)return{key:e,error:!0,source:"raj"};let a={key:e,source:"raj",book:t.bookId,unit:r[t.bookId][t.uid+1]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},113:function(e,t,a){const n=a(178).sprintf,o=["tjl","wos","early","woh","wot","wok","acq"],i=["xxx",...o],r={acq:["xxx","welcome","wom","web"],tjl:["xxx","ack","foreword","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","epilogue"],wos:["xxx","foreword","preface","chap01","chap02","chap03","chap04","afterwords","epilog","prayer"],early:["xxx","ble","c2s","hoe","ign","com","dbc","dth","fem","gar","hea","hoi","hsp","joy1","joy2","lht","moa","mot","wak","wlk"]};function l(e,t){if("woh"===e||"wot"===e||"wok"===e)return n("l%02s",t);if(r[e])return r[e][t];throw new Error(`unexpected bookId: ${e}`)}function s(){return{sourceId:10,keyLength:8}}function c(e){const t={sourceId:10,keyLength:8};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function p(e=location.pathname){let t={sid:10,bid:0,uid:0,hasQuestions:0,qid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=function(e,t,a=!1){if("woh"===e||"wot"===e||"wok"===e)return parseInt(t.substr(1),10);if(r[e])return r[e].indexOf(t);throw new Error(`unexpected bookId: ${e}`)}(a[2],a[3]),-1===t.bid)return-1;5===a.length&&(t.hasQuestions=1,t.qid=parseInt(a[4].substr(1),10));let o=n("%02s%01s%02s%1s%02s",t.sid,t.bid,t.uid,t.hasQuestions,t.qid);return parseInt(o,10)}function d(e,t=!0){let{pid:a,pageKey:n}=c(e),o=n.toString(10),r={error:0,message:"ok",sid:10,bookId:"",uid:0,hasQuestions:!1,qid:0,pid:a-1};if(8!==o.length)return r.error=!0,r.message=`Integer portion of key should have a length of 8, key is: ${o}`,r;let l=parseInt(o.substr(2,1),10);return r.bookId=i[l],t?(r.uid=parseInt(o.substr(3,2),10)-1,r.qid=parseInt(o.substr(6,2),10)-1):(r.uid=parseInt(o.substr(3,2),10),r.qid=parseInt(o.substr(6,2),10)),r.hasQuestions="1"===o.substr(5,1),r}e.exports={getBooks:function(){return o},getSourceId:function(){return 10},getKeyInfo:s,getUrl:function(e,t=!1){let a,n=d(e,!1),o="invalid",i=`/${n.bookId}`;return n.error?"/invalid/key/":(o=l(n.bookId,n.uid),i=`${i}/${o}/`,n.hasQuestions&&(a=`q${n.qid}`,i=`${i}${a}/`),t?`/t/wom${i}`:i)},parseKey:c,genPageKey:p,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=p(t)),n+a},decodeKey:d,describeKey:function(e){let t=d(e,!1);if(t.error)return{key:e,error:!0,source:"wom"};let a={key:e,source:"wom",book:t.bookId};return a.unit=l(t.bookId,t.uid),t.hasQuestions&&(a.question=`q${t.qid}`),t.pid>-1&&(a.pid=`p${t.pid}`),a}}},13:function(e,t,a){const n=a(139).sprintf,o=["til","acq"],i=["xxx",...o],r={acq:["xxx","welcome"],til:["xxx","chap01","chap02","chap03","chap04","chap05","chap06","chap07","chap08","chap09","chap10","chap11","chap12","chap13","chap14","chap15","chap16","chap17","chap18","chap18"]};function l(){return{sourceId:11,keyLength:8}}function s(e){const t={sourceId:11,keyLength:8};let a=e,n=0;"number"==typeof a&&(a=e.toString(10));let o=a.indexOf(".");if(o>-1){let e=a.substr(o+1);switch(e.length){case 1:e=`${e}00`;break;case 2:e=`${e}0`}n=parseInt(e,10)}return{pid:n,pageKey:parseInt(a.substr(0,t.keyLength),10)}}function c(e=location.pathname){let t={sid:11,bid:0,uid:0,hasQuestions:0,qid:0},a=function(e){let t=e;return t=e.substr(1),"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t.split("/")}(e);if(t.bid=i.indexOf(a[2]),-1===t.bid)return-1;if(t.uid=function(e,t){if(r[e])return r[e].indexOf(t);throw new Error(`unexpected bookId: ${e}`)}(a[2],a[3]),-1===t.bid)return-1;5===a.length&&(t.hasQuestions=1,t.qid=parseInt(a[4].substr(1),10));let o=n("%02s%01s%02s%1s%02s",t.sid,t.bid,t.uid,t.hasQuestions,t.qid);return parseInt(o,10)}function p(e){let{pid:t,pageKey:a}=s(e),n=a.toString(10),o={error:0,message:"ok",sid:11,bookId:"",uid:0,hasQuestions:!1,qid:0,pid:t-1};if(8!==n.length)return o.error=!0,o.message=`Integer portion of key should have a length of 8, key is: ${n}`,o;let r=parseInt(n.substr(2,1),10);return o.bookId=i[r],o.uid=parseInt(n.substr(3,2),10)-1,o.hasQuestions="1"===n.substr(5,1),o.qid=parseInt(n.substr(6,2),10)-1,o}e.exports={getNumberOfUnits:function(e){if(r[e])return r[e].length-1;throw new Error(`getNumberOfUnits() unexpected bookId: ${e}`)},getUrl:function(e,t=!1){let a=p(e),n="invalid";return a.error?"/invalid/key/":(r[a.bookId]&&(n=r[a.bookId][a.uid+1]),t?`/t/jsb/${a.bookId}/${n}/`:`/${a.bookId}/${n}/`)},getBooks:function(){return o},getSourceId:function(){return 11},getKeyInfo:l,parseKey:s,genPageKey:c,genParagraphKey:function(e,t=location.pathname){let a,n=t;return a="string"==typeof e?(parseInt(e.substr(1),10)+1)/1e3:(e+1)/1e3,"string"==typeof t&&(n=c(t)),n+a},decodeKey:p,describeKey:function(e){let t=p(e);if(t.error)return{key:e,error:!0,source:"jsb"};let a={key:e,source:"jsb",book:t.bookId,unit:r[t.bookId][t.uid+1]};return t.pid>-1&&(a.pid=`p${t.pid}`),a}}},14:function(e,t,a){"use strict";var n=a(6);const o=a(13);t.a={sid:"jsb",env:"integration",lang:"en",getPageInfo:n.d,keyInfo:o,bm_modal_key:"bm.jsb.modal",bm_creation_state:"bm.jsb.creation",bm_list_store:"bm.jsb.list",bm_topic_list:"bm.jsb.topics",bm_modal_store:"bm.jsb.modal",url_prefix:"/t/jsb"}},202:function(e,t,a){e.exports=a(513)},38:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return r}));var n=a(24);function o(){i(),function(){var e=$(".transcript p");if(0===e.length)return;e.each((function(e){$(this).hasClass("omit")?0:$(this).parents("div.footnotes").length>0||($(this).attr("id","p"+e).addClass("cmiTranPara").prepend(`<span class='pnum'>(p${e})&nbsp;</span>`))}))}(),$(".toggle-paragraph-markers").on("click",(function(e){e.preventDefault();let t=$(".transcript.ui.text.container");t.hasClass("hide-pnum")?t.removeClass("hide-pnum"):t.addClass("hide-pnum")}))}function i(){$(".main.menu").visibility({type:"fixed"}),$(".main.menu  .ui.dropdown").dropdown({on:"hover"})}function r(e="[data-book]"){$("#page-contents").on("mouseover",e,(function(e){n.a.to($(this),.2,{className:"+=gsap-hover"}),n.a.to($(this),.2,{scale:"1.1"})})),$("#page-contents").on("mouseout",e,(function(e){n.a.to($(this),.2,{className:"-=gsap-hover"}),n.a.to($(this),.2,{scale:"1.0"})}))}},39:function(e,t,a){"use strict";a.d(t,"b",(function(){return s}));var n=a(16),o=a.n(n),i=a(6);function r(e){return`\n    <div class="ui ordered relaxed list">\n      ${e.map((e,t)=>`\n        <div class="item"> \n          <a data-lid="${t+1}" href="${e.url}">${e.title}</a>\n        </div>\n      `).join("")}\n    </div>\n  `}function l(e){if(console.log("highlight"),$(".transcript").length>0){let t=location.pathname,a=$(`.toc-list a[href='${t}']`);a.addClass("current-unit").removeAttr("href"),o()(a.get(0));let n=1;switch(e){case"til":n=19;break;case"acq":n=1}!function(e,t){const a=t;let n,o,i=-1,r=-1,l=e.attr("data-lid"),s=parseInt(l,10);1===s?$(".previous-page").addClass("disabled"):($(".previous-page").removeClass("disabled"),i=s-1);s===a?$(".next-page").addClass("disabled"):($(".next-page").removeClass("disabled"),r=s+1);i>-1?(n=$(`a[data-lid="${i}"]`).attr("href"),o=$(`a[data-lid="${i}"]`).text(),$("a.previous-page > span").attr("data-tooltip",`${o}`),$("a.previous-page").attr("href",`${n}`)):$("a.previous-page > span").attr("data-tooltip","At Top");r>-1?(n=$(`a[data-lid="${r}"]`).attr("href"),o=$(`a[data-lid="${r}"]`).text(),$("a.next-page > span").attr("data-tooltip",`${o}`),$("a.next-page").attr("href",`${n}`)):$("a.next-page > span").attr("data-tooltip","At Bottom")}(a,n)}}function s(){return $(".toc-modal-open").attr("data-book")}t.a={initialize:function(e){$(".toc.ui.modal").modal({dimmerSettings:{opacity:.5},observeChanges:!0}),"transcript"===e&&function(){let e=$("#contents-modal-open").attr("data-book").toLowerCase();Object(i.c)(e).then(e=>{$(".toc-image").attr("src",`${e.image}`),$(".toc-title").html(`Table of Contents: <em>${e.title}</em>`),$(".toc-list").html(r(e.contents)),l(e.bid)}).catch(e=>{console.error(e),$(".toc-image").attr("src","/public/img/cmi/toc_modal.png"),$(".toc-title").html("Table of Contents: <em>Error</em>"),$(".toc-list").html(`<p>Error: ${e.message}</p>`),$(".toc.ui.modal").modal("show")})}(),$(".toc-modal-open").on("click",t=>{t.preventDefault();let a=$(t.currentTarget).attr("data-book").toLowerCase();"transcript"!==e?Object(i.c)(a).then(e=>{$(".toc-image").attr("src",`${e.image}`),$(".toc-title").html(`Table of Contents: <em>${e.title}</em>`),$(".toc-list").html(r(e.contents)),$(".toc.ui.modal").modal("show")}).catch(e=>{$(".toc-image").attr("src","/public/img/cmi/toc_modal.png"),$(".toc-title").html("Table of Contents: <em>Error</em>"),$(".toc-list").html(`<p>Error: ${e.message}</p><p>Failed to get ${url}`),$(".toc.ui.modal").modal("show")}):$(".toc.ui.modal").modal("show")})}}},4:function(e,t,a){"use strict";a.d(t,"b",(function(){return d}));var n=a(12),o=a.n(n),i=a(19),r=a.n(i),l=a(3),s=a.n(l),c=(a(8),a(1));let p;r()("rmercer33@gmail.com"),r()("julief8@me.com"),r()("yodi@yodith.com"),r()("hcmercer@gmail.com");function d(e){return p?{email:p.email,userId:r()(p.email),name:p.user_metadata.full_name,roles:p.app_metadata.roles,avatar_url:p.user_metadata.avatar_url}:null}function u(e){let t=s.a.get("login.state")||"init";switch(e){case"init":case"dialog":s.a.set("login.state",e);break;case"login":"dialog"===t&&p.app_metadata.roles&&p.app_metadata.roles.find(e=>"acol"===e)&&location.pathname.startsWith("/t/acol/")&&"/t/acol/"!==location.pathname&&(location.href="/t/acol/"),s.a.set("login.state",e)}}t.a={initialize:function(){o.a.on("init",e=>{u("init")}),o.a.on("login",e=>{p=e,function(){let e=d();Object(c.b)("action:signout",!0).then(t=>{$(".login-menu-option > span").html("<i class='green sign out icon'></i>").attr("data-tooltip",`${t}: ${e.name}`)}),$(".main.menu a > span > i.bookmark.icon").addClass("green").removeClass("red"),$(".main.menu .ui.text.container").addClass("signed-in"),$(".hide.profile-management.item").removeClass("hide")}(),u("login")}),o.a.on("logout",()=>{Object(c.b)("action:signin",!0).then(e=>{$(".login-menu-option > span").html("<i class='red sign in icon'></i>").attr("data-tooltip",e)}),$(".main.menu a > span > i.bookmark.icon").addClass("red").removeClass("green"),$(".main.menu .ui.text.container").removeClass("signed-in"),$(".profile-management.item").addClass("hide"),p=null,location.href="/"}),o.a.on("error",e=>{console.error("user.on('error'): ",e)}),$(".login-menu-option").on("click",e=>{e.preventDefault(),p?o.a.logout():(u("dialog"),o.a.open())}),o.a.init({})}}},432:function(e,t,a){var n=a(433);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},433:function(e,t,a){},434:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.time-jump-forward"]=["Jump forward 1 second","Jump forward %1 seconds"],Object.assign(mejs.MepDefaults,{jumpForwardInterval:30,jumpForwardText:null}),Object.assign(MediaElementPlayer.prototype,{buildjumpforward:function(e,t,a,n){var o=this,i=mejs.i18n.t("mejs.time-jump-forward",o.options.jumpForwardInterval),r=mejs.Utils.isString(o.options.jumpForwardText)?o.options.jumpForwardText.replace("%1",o.options.jumpForwardInterval):i,l=document.createElement("div");l.className=o.options.classPrefix+"button "+o.options.classPrefix+"jump-forward-button",l.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+r+'" aria-label="'+r+'" tabindex="0">'+o.options.jumpForwardInterval+"</button>",o.addControlElement(l,"jumpforward"),l.addEventListener("click",(function(){var e=isNaN(n.duration)?o.options.jumpForwardInterval:n.duration;if(e){var t=n.currentTime===1/0?0:n.currentTime;n.setCurrentTime(Math.min(t+o.options.jumpForwardInterval,e)),this.querySelector("button").blur()}}))}})},{}]},{},[1])},435:function(e,t,a){var n=a(436);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},436:function(e,t,a){},437:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.time-skip-back"]=["Skip back 1 second","Skip back %1 seconds"],Object.assign(mejs.MepDefaults,{skipBackInterval:30,skipBackText:null}),Object.assign(MediaElementPlayer.prototype,{buildskipback:function(e,t,a,n){var o=this,i=mejs.i18n.t("mejs.time-skip-back",o.options.skipBackInterval),r=mejs.Utils.isString(o.options.skipBackText)?o.options.skipBackText.replace("%1",o.options.skipBackInterval):i,l=document.createElement("div");l.className=o.options.classPrefix+"button "+o.options.classPrefix+"skip-back-button",l.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+r+'" aria-label="'+r+'" tabindex="0">'+o.options.skipBackInterval+"</button>",o.addControlElement(l,"skipback"),l.addEventListener("click",(function(){if(isNaN(n.duration)?o.options.skipBackInterval:n.duration){var e=n.currentTime===1/0?0:n.currentTime;n.setCurrentTime(Math.max(e-o.options.skipBackInterval,0)),this.querySelector("button").blur()}}))}})},{}]},{},[1])},438:function(e,t,a){var n=a(439);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},439:function(e,t,a){},440:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.speed-rate"]="Speed Rate",Object.assign(mejs.MepDefaults,{speeds:["2.00","1.50","1.25","1.00","0.75"],defaultSpeed:"1.00",speedChar:"x",speedText:null}),Object.assign(MediaElementPlayer.prototype,{buildspeed:function(e,t,a,n){var o=this;if(null!==o.media.rendererName&&/(native|html5)/i.test(o.media.rendererName)){for(var i=[],r=mejs.Utils.isString(o.options.speedText)?o.options.speedText:mejs.i18n.t("mejs.speed-rate"),l=function(e){for(var t=0,a=i.length;t<a;t++)if(i[t].value===e)return i[t].name},s=void 0,c=!1,p=0,d=o.options.speeds.length;p<d;p++){var u=o.options.speeds[p];"string"==typeof u?(i.push({name:""+u+o.options.speedChar,value:u}),u===o.options.defaultSpeed&&(c=!0)):(i.push(u),u.value===o.options.defaultSpeed&&(c=!0))}c||i.push({name:o.options.defaultSpeed+o.options.speedChar,value:o.options.defaultSpeed}),i.sort((function(e,t){return parseFloat(t.value)-parseFloat(e.value)})),o.cleanspeed(e),e.speedButton=document.createElement("div"),e.speedButton.className=o.options.classPrefix+"button "+o.options.classPrefix+"speed-button",e.speedButton.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+r+'" aria-label="'+r+'" tabindex="0">'+l(o.options.defaultSpeed)+'</button><div class="'+o.options.classPrefix+"speed-selector "+o.options.classPrefix+'offscreen"><ul class="'+o.options.classPrefix+'speed-selector-list"></ul></div>',o.addControlElement(e.speedButton,"speed");for(var h=0,m=i.length;h<m;h++){var f=o.id+"-speed-"+i[h].value;e.speedButton.querySelector("ul").innerHTML+='<li class="'+o.options.classPrefix+'speed-selector-list-item"><input class="'+o.options.classPrefix+'speed-selector-input" type="radio" name="'+o.id+'_speed"disabled="disabled" value="'+i[h].value+'" id="'+f+'"  '+(i[h].value===o.options.defaultSpeed?' checked="checked"':"")+'/><label for="'+f+'" class="'+o.options.classPrefix+"speed-selector-label"+(i[h].value===o.options.defaultSpeed?" "+o.options.classPrefix+"speed-selected":"")+'">'+i[h].name+"</label></li>"}s=o.options.defaultSpeed,e.speedSelector=e.speedButton.querySelector("."+o.options.classPrefix+"speed-selector");for(var g=["mouseenter","focusin"],b=["mouseleave","focusout"],$=e.speedButton.querySelectorAll('input[type="radio"]'),k=e.speedButton.querySelectorAll("."+o.options.classPrefix+"speed-selector-label"),v=0,y=g.length;v<y;v++)e.speedButton.addEventListener(g[v],(function(){mejs.Utils.removeClass(e.speedSelector,o.options.classPrefix+"offscreen"),e.speedSelector.style.height=e.speedSelector.querySelector("ul").offsetHeight,e.speedSelector.style.top=-1*parseFloat(e.speedSelector.offsetHeight)+"px"}));for(var x=0,w=b.length;x<w;x++)e.speedSelector.addEventListener(b[x],(function(){mejs.Utils.addClass(this,o.options.classPrefix+"offscreen")}));for(var I=0,C=$.length;I<C;I++){var j=$[I];j.disabled=!1,j.addEventListener("click",(function(){var t=this.value;s=t,n.playbackRate=parseFloat(t),e.speedButton.querySelector("button").innerHTML=l(t);for(var a=e.speedButton.querySelectorAll("."+o.options.classPrefix+"speed-selected"),i=0,r=a.length;i<r;i++)mejs.Utils.removeClass(a[i],o.options.classPrefix+"speed-selected");this.checked=!0;for(var c=mejs.Utils.siblings(this,(function(e){return mejs.Utils.hasClass(e,o.options.classPrefix+"speed-selector-label")})),p=0,d=c.length;p<d;p++)mejs.Utils.addClass(c[p],o.options.classPrefix+"speed-selected")}))}for(var T=0,O=k.length;T<O;T++)k[T].addEventListener("click",(function(){var e=mejs.Utils.siblings(this,(function(e){return"INPUT"===e.tagName}))[0],t=mejs.Utils.createEvent("click",e);e.dispatchEvent(t)}));e.speedSelector.addEventListener("keydown",(function(e){e.stopPropagation()})),n.addEventListener("loadedmetadata",(function(){s&&(n.playbackRate=parseFloat(s))}))}},cleanspeed:function(e){e&&(e.speedButton&&e.speedButton.parentNode.removeChild(e.speedButton),e.speedSelector&&e.speedSelector.parentNode.removeChild(e.speedSelector))}})},{}]},{},[1])},441:function(e,t,a){var n=a(442);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},442:function(e,t,a){},443:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.nextp"]="Next Paragraph",Object.assign(mejs.MepDefaults,{nextpText:null}),Object.assign(MediaElementPlayer.prototype,{buildnextp:function(e,t,a,n){var o=this,i=mejs.Utils.isString(o.options.nextpText)?o.options.nextpText:mejs.i18n.t("mejs.nextp"),r=document.createElement("div");r.className=o.options.classPrefix+"button "+o.options.classPrefix+"nextp-button "+o.options.classPrefix+"nextp",r.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+i+'" aria-label="'+i+'" tabindex="0"></button>',o.addControlElement(r,"nextp"),r.addEventListener("click",(function(){if(!e.paused){var t=mejs.Utils.createEvent("nextp",n);n.dispatchEvent(t)}}))}})},{}]},{},[1])},444:function(e,t,a){var n=a(445);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},445:function(e,t,a){},446:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.prevp"]="Previous Paragraph",Object.assign(mejs.MepDefaults,{prevpText:null}),Object.assign(MediaElementPlayer.prototype,{buildprevp:function(e,t,a,n){var o=this,i=mejs.Utils.isString(o.options.prevpText)?o.options.prevpText:mejs.i18n.t("mejs.prevp"),r=document.createElement("div");r.className=o.options.classPrefix+"button "+o.options.classPrefix+"prevp-button "+o.options.classPrefix+"prevp",r.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+i+'" aria-label="'+i+'" tabindex="0"></button>',o.addControlElement(r,"prevp"),r.addEventListener("click",(function(){if(!e.paused){var t=mejs.Utils.createEvent("prevp",n);n.dispatchEvent(t)}}))}})},{}]},{},[1])},447:function(e,t,a){var n=a(448);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},448:function(e,t,a){},449:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.ptoggle"]="Show/Hide Paragraph Jump Markers",Object.assign(mejs.MepDefaults,{ptoggleText:null}),Object.assign(MediaElementPlayer.prototype,{buildptoggle:function(e,t,a,n){var o=this,i=mejs.Utils.isString(o.options.ptoggleText)?o.options.ptoggleText:mejs.i18n.t("mejs.ptoggle"),r=document.createElement("div");r.className=o.options.classPrefix+"button "+o.options.classPrefix+"ptoggle-button "+o.options.classPrefix+"ptoggle",r.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+i+'" aria-label="'+i+'" tabindex="0"></button>',o.addControlElement(r,"ptoggle"),r.addEventListener("click",(function(){var e=mejs.Utils.createEvent("ptoggle",n);n.dispatchEvent(e)}))}})},{}]},{},[1])},450:function(e,t,a){var n=a(451);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};a(30)(n,o);n.locals&&(e.exports=n.locals)},451:function(e,t,a){},452:function(e,t,a){
/*!
 * MediaElement.js
 * http://www.mediaelementjs.com/
 *
 * Wrapper that mimics native HTML5 MediaElement (audio and video)
 * using a variety of technologies (pure JavaScript, Flash, iframe)
 *
 * Copyright 2010-2017, John Dyer (http://j.hn/)
 * License: MIT
 *
 */
!function e(t,a,n){function o(r,l){if(!a[r]){if(!t[r]){if(i)return i(r,!0);var s=new Error("Cannot find module '"+r+"'");throw s.code="MODULE_NOT_FOUND",s}var c=a[r]={exports:{}};t[r][0].call(c.exports,(function(e){var a=t[r][1][e];return o(a||e)}),c,c.exports,e,t,a,n)}return a[r].exports}for(var i=!1,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";mejs.i18n.en["mejs.capture"]="Show/Hide Audio Capture Markers",Object.assign(mejs.MepDefaults,{capture:null}),Object.assign(MediaElementPlayer.prototype,{buildcapture:function(e,t,a,n){var o=this,i=mejs.Utils.isString(o.options.captureText)?o.options.captureText:mejs.i18n.t("mejs.capture"),r=document.createElement("div");r.className=o.options.classPrefix+"button "+o.options.classPrefix+"capture-button "+o.options.classPrefix+"capture",r.innerHTML='<button type="button" aria-controls="'+o.id+'" title="'+i+'" aria-label="'+i+'" tabindex="0"></button>',o.addControlElement(r,"capture"),r.addEventListener("click",(function(){var e=mejs.Utils.createEvent("capture",n);n.dispatchEvent(e)}))}})},{}]},{},[1])},49:function(e,t,a){"use strict";a.d(t,"a",(function(){return Kt}));var n=a(2),o=a.n(n),i=a(3),r=a.n(i),l=a(7),s=a.n(l),c=a(75),p=a.n(c),d=a(76),u=a.n(d),h=a(31),m=a.n(h),f=a(4),g=a(514),b=a(15),k=a.n(b),v=a(77),y=a.n(v),x=a(23),w=a.n(x),I=a(10),C=a.n(I),j="https://rcd7l4adth.execute-api.us-east-1.amazonaws.com/latest/share",T="https://93e93isn03.execute-api.us-east-1.amazonaws.com/latest/user",O="https://93e93isn03.execute-api.us-east-1.amazonaws.com/latest",S="https://rcd7l4adth.execute-api.us-east-1.amazonaws.com/latest",E=a(1);let L={},D={};function P(e){L=e,function(){const e=Object(f.b)();if(!e)return;let t=[],a=`${e.userId}/maillist`;s()(`${T}/${a}`).then(e=>{t=e.data.maillist;let a=function(e){return`\n    <label>${Object(E.b)("label:listnames")}</label>\n    <select name="mailList" id="maillist-address-list" multiple="" class="search ui dropdown">\n      <option value="">${Object(E.b)("label:selectaddress")}</option>\n      ${e.map(e=>`${function(e){return`<option value="${e.address}">${e.first} ${e.last}</option>`}(e)}`).join("")}\n    </select>\n  `}(t);$("#maillist-select").html(a),$("#maillist-address-list.dropdown").dropdown()}).catch(e=>{o.a.error(`${Object(E.b)("error:e10")}: ${e}`)})}(),$("form[name='emailshare']").on("submit",(function(e){e.preventDefault();const t=Object(f.b)();if(!t)return o.a.warning(Object(E.b)("annotate:m14")),void $(".email-share-dialog-wrapper").addClass("hide");let a=$("#email-share-form").form("get values");0!==a.mailList.length||0!==a.emailAddresses.length?(D.to="",a.mailList.length>0&&(D.to=a.mailList.join(",")),a.emailAddresses.length>0&&(D.to.length>0?D.to=`${D.to}, ${a.emailAddresses}`:D.to=a.emailAddresses),D.senderName=t.name,D.senderEmail=t.email,D.sid=L.sid,$(".email-share-dialog-wrapper").addClass("hide"),s.a.post(j,D).then(e=>{200===e.status?o.a.info(Object(E.b)("action:emailsent")):o.a.info(e.data.message)}).catch(e=>{console.error("share error: %s",e)})):o.a.info(Object(E.b)("error:e9"))})),$("form[name='emailshare'] .email-share-cancel").on("click",(function(e){e.preventDefault(),$(".email-share-dialog-wrapper").addClass("hide")}))}var K=a(11);let _,N={},q=!1;function B(e){return e&&0!==e.length?`\n    <div class="ui horizontal bulleted list">\n      ${e.map(e=>`\n        <div class="item">\n          <em>${"object"==typeof e?e.topic:e}</em>\n        </div>\n      `).join("")}\n    </div>\n  `:Object(E.b)("annotate:m13")}function U(e,t,a){return`\n    <div class="ui list">\n      <div class="item">\n        <i class="bookmark icon"></i>\n        <div class="content">\n          <div class="header">\n            Paragraph: ${e}\n          </div>\n          <div class="list">\n            ${t.map(e=>`\n              ${function(e,t=[]){let a;e.topicList||(e.topicList=[]);let n=e.topicList.map(e=>"object"==typeof e?e.value:e);return t.length>0&&(a=y()(n,t)),0===t.length||a.length>0?`\n      <div class="item"> \x3c!-- item: ${e.rangeStart}/${e.rangeEnd} --\x3e\n        <i class="right triangle icon"></i>\n        <div class="content">\n          <div class="header">\n            ${B(e.topicList)}\n          </div>\n          <div class="description">\n            <a data-aid="${e.aid}" class="annotation-item" data-range="${e.rangeStart}/${e.rangeEnd}">\n              ${e.Comment?e.Comment:Object(E.b)("annotate:m7")}\n            </a>\n          </div>\n        </div>\n      </div> \x3c!-- item: ${e.rangeStart}/${e.rangeEnd} --\x3e\n    `:`\x3c!-- annotation filtered: ${t.join(" ")} --\x3e`}(e,a)}\n            `).join("")}\n          </div>\n        </div>\n      </div>\n    </div>\n `}function M(e,t,a){let n,o=e[t][a];return n=o[0].selectedText?`${o[0].selectedText.url}?bkmk=${o[0].rangeStart}`:`${N.url_prefix}${N.keyInfo.getUrl(t)}?bkmk=${o[0].rangeStart}`,n}function A(e,t,a){let n=Object.keys(t),o=n.indexOf("lastFetchDate");if(o>-1&&n.splice(o,1),o=n.indexOf(e),-1===o)return Promise.reject("bookmark not found");let i=function(e,t,a,n){if(e>t.length)return Promise.resolve(null);let o,i,r=!1;e:for(o=e;o<t.length;o++){let e=n[t[o]];for(i in e)for(let t=0;t<e[i].length;t++){if(!a||0===a.length){r=!0;break e}if(w()(a,e[i][t].topicList||[],(e,t)=>e===t.value).length>0){r=!0;break e}}}return new Promise(e=>{if(r){let a=t[o],r=M(n,a,i);e(r||null)}else e(null)})}(o+1,n,a.modal.topics,t),r=function(e,t,a,n){if(e<0)return Promise.resolve(null);let o,i,r=!1;e:for(o=e;o>=0;o--){let e=n[t[o]];for(i in e)for(let t=0;t<e[i].length;t++){if(!a||0===a.length){r=!0;break e}if(w()(a,e[i][t].topicList||[],(e,t)=>e===t.value).length>0){r=!0;break e}}}return new Promise(e=>{if(r){let a=t[o];e(M(n,a,i))}else e(null)})}(o-1,n,a.modal.topics,t);return Promise.all([r,i])}function F(e,t,a,n,o){let i,r,l=[];n.modal.filter&&(l=n.modal.topics,r=B(n.modal.fullTopic)),i=(parseInt(t.substr(1),10)+1).toString(10);let s=a[e][i];if(!s)return!1;let c=U(t,s,l);r?($("#filter-topics-section").removeClass("hide"),$(".bookmark-navigator-filter").html(r)):$("#filter-topics-section").addClass("hide"),$(".bookmark-navigator-header-book").text($("#book-title").text()),$("#bookmark-content").html(c);let p,d,u=Object.keys(a[e]),h=u.indexOf(i);return p=function(e,t,a,n){if(e<1)return null;if(0===n.length)return`p${(parseInt(t[e-1],10)-1).toString(10)}`;for(let o=e-1;o>=0;o--){let e=a[t[o]];for(let a=0;a<e.length;a++)if(e[a].topicList&&e[a].topicList.length>0){if(w()(e[a].topicList,n,(e,t)=>e.value===t).length>0)return`p${(parseInt(t[o],10)-1).toString(10)}`}}return null}(h,u,a[e],l),d=function(e,t,a,n){if(e+1===t.length)return null;if(0===n.length)return`p${(parseInt(t[e+1],10)-1).toString(10)}`;for(let o=e+1;o<t.length;o++){let e=a[t[o]];for(let a=0;a<e.length;a++)if(e[a].topicList&&e[a].topicList.length>0){if(w()(e[a].topicList,n,(e,t)=>e.value===t).length>0)return`p${(parseInt(t[o],10)-1).toString(10)}`}}return null}(h,u,a[e],l),$(".bookmark-navigator .current-bookmark").attr("data-pid",`${t}`),Object(E.b)("action:prev",!0).then(e=>{p?($(".bookmark-navigator .previous-bookmark").attr("data-pid",p),$(".bookmark-navigator .previous-bookmark").removeClass("inactive"),$(".bookmark-navigator .previous-bookmark").html(`<i class="up arrow icon"></i> ${e} (${p})`)):($(".bookmark-navigator .previous-bookmark").addClass("inactive"),$(".bookmark-navigator .previous-bookmark").html(`<i class='up arrow icon'></i>${e}`))}),Object(E.b)("action:next",!0).then(e=>{d?($(".bookmark-navigator .next-bookmark").attr("data-pid",d),$(".bookmark-navigator .next-bookmark").removeClass("inactive"),$(".bookmark-navigator .next-bookmark").html(`<i class="down arrow icon"></i> ${e} (${d})`)):($(".bookmark-navigator .next-bookmark").addClass("inactive"),$(".bookmark-navigator .next-bookmark").html(`<i class='down arrow icon'></i> ${e}`))}),!0}function R(e){N.keyInfo.getSourceId();let t=N.keyInfo.genPageKey().toString(10),a=r.a.get(N.bm_list_store),n=r.a.get(N.bm_modal_store);a?(_=t,A(t,a,n).then(i=>{null!==i[0]?$(".bookmark-navigator .previous-page").attr({href:i[0]}):$(".bookmark-navigator .previous-page").addClass("inactive").removeAttr("href"),null!==i[1]?$(".bookmark-navigator .next-page").attr({href:i[1]}):$(".bookmark-navigator .next-page").addClass("inactive").removeAttr("href"),F(t,e,a,n)?($(".bookmark-navigator .previous-bookmark").on("click",(function(e){e.preventDefault(),z();let t=$(this).attr("data-pid");C()(document.getElementById(t),{align:{top:.2}},e=>{J(`bookmark navigator previous-bookmark(${t})`,e)}),H(t,"previous")})),$(".bookmark-navigator .next-bookmark").on("click",(function(e){e.preventDefault(),z();let t=$(this).attr("data-pid");C()(document.getElementById(t),{align:{top:.2}},e=>{J(`bookmark navigator next-bookmark(${t})`,e)}),H(t,"next")})),$(".bookmark-navigator .current-bookmark").on("click",(function(e){e.preventDefault();let t=$(this).attr("data-pid");C()(document.getElementById(t),{align:{top:.2}},e=>{J(`bookmark navigator current-bookmark(${t})`,e)})})),$(".bookmark-navigator .close-window").on("click",(function(e){e.preventDefault(),z(),$(".bookmark-navigator-wrapper").addClass("hide-bookmark-navigator"),$(".transcript").removeClass("bookmark-navigator-active")})),$(".bookmark-navigator").on("click",".annotation-item",(function(e){e.preventDefault(),z();let t=Object(f.b)();t||(t={userId:"xxx"});let a,n=$(this).attr("data-aid"),o=$(this).attr("data-range").split("/"),i=o[0];"undefined"!==n?(a=$(`[data-annotation-id='${n}']`).attr("data-aid"),$(`[data-annotation-id="${a}"]`).addClass("show")):a=$(`#${i} > span.pnum`).attr("data-aid");let r,l=`https://${location.hostname}${location.pathname}?as=${i}:${a}:${t.userId}`,s=o.map(e=>parseInt(e.substr(1),10)),c=k()(s[0],s[1]+1);r="xxx"===t.userId?`\n        <h4 class="ui header">\n          <i title="${Object(E.b)("annotate:m11")}" class="red window close outline small icon"></i>\n          <div class="content">\n            ${$(this).text()}\n          </div>\n        </h4>\n      `:E.a`
        <h4 class="ui header">
          <i title="${"action:fbshare"}" class="share-annotation facebook small icon"></i>
          <i title="${"action:emailshare"}" class="share-annotation envelope outline small icon"></i>
          <i data-clipboard-text="${l}" title="${"action:cp2clip"}" class="share-annotation linkify small icon"></i>
          <div class="content">
            ${$(this).text()}
          </div>
        </h4>
      `;for(let e=0;e<c.length;e++)$(`#p${c[e]}`).addClass("selected-annotation");$(".selected-annotation").wrapAll("<div class='selected-annotation-wrapper ui raised segment'></div>"),$(".selected-annotation-wrapper").prepend(r),"xxx"!==t.userId&&K.a.register(".share-annotation.linkify")})),V("bookmark/navigator.js"),$(".transcript").addClass("bookmark-navigator-active"),$(".bookmark-navigator-wrapper").removeClass("hide-bookmark-navigator"),setTimeout(Q,250,e,"bookmarkManager")):o.a.info(E.a`${"fragment:f1"} ${e} ${"fragment:f2"}`)}).catch(t=>{console.error(t),"bookmark not found"===t&&o.a.info(E.a`${"fragment:f1"} ${e} ${"fragment:f2"}`)})):console.log(N.bm_list_store)}function H(e,t){let a=r.a.get(N.bm_list_store),n=r.a.get(N.bm_modal_store);F(_,e,a,n)}function z(){let e=$(".selected-annotation");if(e.length>0){$(".selected-annotation-wrapper > .header").remove(),e.unwrap().removeClass("selected-annotation"),$(".bookmark-selected-text.show").removeClass("show");let t=$("div.transcript.ui.disable-selection:not(.user)");t.length>0&&(console.log("removing selection guard"),t.removeClass("disable-selection"))}}function J(e,t){console.log(`${e}: ${t}`)}function Q(e,t){C()(document.getElementById(e),{align:{top:.2}},a=>{J(`scroll from bookmark navigator ${t}(${e})`,a)})}function V(e){q||($(".transcript").on("click",".selected-annotation-wrapper .share-annotation",(function(e){e.preventDefault();let t,a,n,i=$(".selected-annotation-wrapper mark.show");if($(this).hasClass("close"))return void z();if(t=Object(f.b)(),!t)return void o.a.info(Object(E.b)("annotate:m14"));let r,l=$(".selected-annotation-wrapper i[data-clipboard-text]").attr("data-clipboard-text"),s=l.indexOf("undefined");if($(this).hasClass("facebook"))r="facebook";else if($(this).hasClass("envelope"))r="email";else if($(this).hasClass("linkify"))return s>-1?void o.a.error(Object(E.b)("error:e5")):void(r="clipboard");a=$(".selected-annotation-wrapper p").attr("id"),n=0===i.length?$(`#${a}`).text().replace(/\n/," "):i.text().replace(/\n/," ");let c=`~ ${$("#src-title").text()}: ${$("#book-title").text()}`;if("facebook"===r){if(s>-1)return void o.a.error(Object(E.b)("error:e5"));let e={method:"share",hashtag:"#christmind",quote:`${n}\n${c}`,href:l};FB.ui(e,(function(){}))}else if("email"===r){if(s>-1)return void o.a.error(Object(E.b)("error:e5"));!function(e,t,a){D={citation:t,quote:e,url:a},$(".hide.email-share-dialog-wrapper").removeClass("hide")}(n,c,l)}})),q=!0)}let W={};var Y=!1;function G(){Object(f.b)()||Y||(o.a.options.timeOut="10000",o.a.success(Object(E.b)("annotate:m1")),o.a.warning(Object(E.b)("annotate:m2")),Y=!0)}function X(){return E.a`
    <form name="annotation" id="annotation-form" class="ui form">
      <input class="hidden-field" type="text" readonly="" name="creationDate">
      <input class="hidden-field" type="text" name="aid" readonly>
      <input class="hidden-field" type="text" readonly="" name="rangeStart">
      <div class="fields">
        <div class="three wide field">
          <input id="rangeEnd" type="text" name="rangeEnd" maxlength="4" placeholder="${"label:end"}">
        </div>
        <div id="available-topics" class="twelve wide field"></div>
        </div>
      </div>
      <div class="field">
        <input type="text" name="Comment" placeholder="${"label:comment"}">
      </div>
      <div class="field">
        <input type="text" name="newTopics" placeholder="${"label:newtopic"}">
      </div>
      <div class="field">
        <textarea name="Note" placeholder="${"label:notes"}" rows="3"></textarea>
      </div>
      <div class="fields">
        <button class="annotation-submit ui green button" type="submit">${"action:submit"}</button>
        <button class="annotation-cancel ui red basic button">${"action:cancel"}</button>
        <button class="annotation-share ui green disabled basic button">${"action:share"}</button>
        <button class="annotation-note ui blue basic button">${"label:links"}</button>
        <div class="twelve wide field">
          <button class="annotation-delete ui red disabled right floated button">${"action:delete"}</button>
        </div>
      </div>
    </form>
    <div class="note-and-links hide">
      <table id="bookmark-link-table" class="ui selectable celled table">
        <thead>
          <tr>
            <th></th>
            <th></th>
            <th>${"label:linkref"}</th>
            <th>${"label:link"}</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="bookmark-link-list">
        </tbody>
      </table>
      <form name="linkForm" id="link-form" class="ui form">
        <div class="fields">
          <div class="ten wide field">
            <input required type="text" placeholder="${"label:linknote"}" name="reference">
          </div>
          <div class="five wide field">
            <input required type="text" placeholder="${"label:link"}" name="link">
          </div>
          <button title="add or update" data-index="-1" type="submit" class="green ui icon button">
            <i class="plus circle icon"></i>
          </button>
          <button title="clear fields" type="reset" class="yellow ui icon button">
            <i class="minus circle icon"></i>
          </button>
        </div>
      </form>
    </div>
  `}let Z=[];function ee(e){return Z[e]}function te(e){$("#link-form [type='submit']").data("index",e)}function ae(e){let t=JSON.parse(e),a=`${t.desc.source}:${t.desc.book}:${t.desc.unit}`;return a=t.desc.question?`${a}:${t.desc.question}:${t.desc.pid}`:`${a}:${t.desc.pid}`,a}function ne(){$(".transcript").on("submit","#link-form",(function(e){e.preventDefault();let t=function(){let e=$("#link-form [type='submit']").data("index");return parseInt(e,10)}(),a=-1===t?"new":"edit",n=$("#link-form").form("get values");if(!function(e,t){let a,n=W.keyInfo.genParagraphKey(e);try{a=JSON.parse(t)}catch(e){return o.a.error(Object(E.b)("annotate:m3")),!1}return a.aid&&a.desc&&a.key&&a.userId?a.key!==n||(o.a.error(Object(E.b)("annotate:m5")),!1):(o.a.error(Object(E.b)("annotate:m4")),!1)}($(".annotate-wrapper p.cmiTranPara").attr("id"),n.link))return;let i=ae(n.link);if("new"===a){Z.push({reference:n.reference,link:n.link,deleted:!1});let e=function(e,t){return E.a`
    <tr data-index="${t}">
      <td title="${"action:delete"}" class="delete-link-item"><i class="red trash alternate icon"></i></td>
      <td title="${"action:edit"}" class="edit-link-item"><i class="yellow pencil alternate icon"></i></td>
      <td data-name="reference">${e.reference}</td>
      <td data-name="link">${e.link}</td>
      <td title="${"action:follow"}" class="follow-link-item"><i class="green share icon"></i></td>
    </tr>
  `}({reference:n.reference,link:i},Z.length-1);$("#bookmark-link-list").append(e)}else Z[t]={reference:n.reference,link:n.link,deleted:!1},$(`tr[data-index="${t}"] > td[data-name="reference"]`).text(Z[t].reference),$(`tr[data-index="${t}"] > td[data-name="link"]`).text(i),te(-1);$("#link-form").form("clear")})),$(".transcript").on("click","#bookmark-link-list td.delete-link-item",(function(e){e.stopPropagation(),e.preventDefault();let t=$(this).parent(),a=parseInt(t.attr("data-index"),10);Z[a].deleted=!0,t.remove()})),$(".transcript").on("click","#bookmark-link-list td.edit-link-item",(function(e){e.stopPropagation(),e.preventDefault();let t=parseInt($(this).parent().attr("data-index"),10);$("#link-form").form("set values",Z[t]),te(t)}))}const oe='\n  <div class="annotate-wrapper ui raised segment"></div>';function ie(e){return e&&0!==e.length?`\n    ${e.map(e=>`\n      <div class="item">\n        <em>${e.topic}</em>\n      </div>\n    `).join("")}\n  `:`\n      <div class="item">\n        <em>${Object(E.b)("annotate:m6")}</em>\n      </div>\n    `}function re(e){let t=[];return e.Note&&t.push("N"),e.links&&t.push(`L${e.links.length}`),0===t.length?'\n      <div class="item">\n        <i class="bookmark outline icon"></i>\n      </div>\n    ':`\n    ${t.map(e=>`\n      <div class="item">\n        ${function(e){let t;if("N"===e)t="<i class='align justify icon'></i>";else if(e.startsWith("L")){let a=e.substr(1);t=`<i class="linkify icon"></i>[${a}]`}return`${t}`}(e)}\n      </div>\n    `).join("")}\n  `}function le(e){return e||Object(E.b)("annotate:m6")}function se(e,t,a){let n=$("#annotation-form");$("#link-form");if(Z=[],a){let e=[];if(a.topicList&&(e=a.topicList.map(e=>e.value)),a.links){Z=a.links;let e=`\n    ${Z.map((e,t)=>E.a`
      <tr data-index="${t}">
        <td title="${"action:delete"}" class="delete-link-item"><i class="red trash alternate icon"></i></td>
        <td title="${"action:edit"}" class="edit-link-item"><i class="yellow pencil alternate icon"></i></td>
        <td data-name="reference">${e.reference}</td>
        <td data-name="link">${ae(e.link)}</td>
        <td title="${"action:follow"}" class="follow-link-item"><i class="green share icon"></i></td>
      </tr>
    `).join("")}\n  `;$("#bookmark-link-list").html(e)}n.form("set values",{rangeStart:a.rangeStart,rangeEnd:a.rangeEnd,aid:a.aid,creationDate:a.creationDate,Comment:a.Comment,Note:a.Note,topicList:e})}else n.form("set values",{rangeStart:e,rangeEnd:e,aid:t});document.getElementById("rangeEnd").focus()}function ce(){return $("#annotation-form").form("get values")}function pe(e){let t=$(".transcript .annotation-edit");if(t.length>0){let a=t.first(1).attr("id");return e!==a&&o.a.info(E.a`${"annotate:m8"} ${a}. ${"annotate:m9"}`),!0}return!1}function de(){return!!$(".transcript").hasClass("bookmark-navigator-active")&&(o.a.info(Object(E.b)("annotate:m10")),!0)}function ue(e,t,a){let n=parseInt(a.rangeStart.substr(1),10),o=parseInt(a.rangeEnd.substr(1),10);if(n!==o){let e=k()(n,o+1);for(let t=0;t<e.length;t++)$(`#p${e[t]}`).addClass("annotation-edit")}else $(`#${e}`).addClass("annotation-edit");G(),fe(),$(".annotation-edit").wrapAll(oe),$(".annotate-wrapper").prepend(X()),$(".annotation-delete.disabled").removeClass("disabled"),$(".annotation-share.disabled").removeClass("disabled"),$e(e,t,a)}function he(e,t){let a=W.keyInfo.genParagraphKey(e),n=W.keyInfo.describeKey(a),o={userId:Object(f.b)().userId,key:a,aid:t,desc:n};return JSON.stringify(o)}function me(){let e=$("div.transcript.ui.disable-selection:not(.user)");e.length>0&&e.removeClass("disable-selection")}function fe(){let e=$("div.transcript.ui");e.hasClass("disable-selection")||e.addClass("disable-selection")}function ge(e){W=e||$t,$(".transcript").on("submit","#annotation-form",(function(e){e.preventDefault(),me();let t=ce();if(t.topicList.length>0){let e=t.topicList.map(e=>({value:e,topic:$(`#annotation-topic-list > [value='${e}']`).text()}));t.topicList=e}be(),$(`[data-annotation-id="${t.aid}"]`).removeClass("show"),$(".transcript .annotation-edit").hasClass("annotation-note")&&(t.bookTitle=$("#book-title").text());let a=Z.filter(e=>!1===e.deleted);a.length>0?t.links=a:Z.filter(e=>!0===e.deleted).length>0&&t.creationDate.length>0&&$(`i[data-link-aid="${t.creationDate}"]`).remove(),Ct.submit(t),$(".transcript .annotation-edit").removeClass("annotation-edit annotation-note")})),$(".transcript").on("click","#annotation-form .annotation-cancel",(function(e){e.preventDefault(),me();let t=ce();be(),$(`[data-annotation-id="${t.aid}"]`).removeClass("show"),Ct.cancel(t),$(".transcript .annotation-edit").removeClass("annotation-edit")})),$(".transcript").on("click","#annotation-form .annotation-share",(function(e){e.preventDefault();let t=ce();be(),$(`[data-annotation-id="${t.aid}"]`).removeClass("show"),Ct.cancel(t),$(".transcript .annotation-edit").removeClass("annotation-edit");let a=Object(f.b)();a||(a={userId:"xxx"});let n,o=t.aid,i=[t.rangeStart,t.rangeEnd],r=i.map(e=>parseInt(e.substr(1),10)),l=i[0];o.length>0?(n=$(`[data-annotation-id="${o}"]`).attr("data-aid"),$(`[data-annotation-id="${o}"]`).addClass("show")):n=$(`#${l} > span.pnum`).attr("data-aid");let s,c=`https://${location.hostname}${location.pathname}?as=${l}:${n}:${a.userId}`,p=k()(r[0],r[1]+1);s="xxx"===a.userId?`\n        <h4 class="ui left floated header">\n          <i title="${Object(E.b)("annotate:m11")}" class="red window close outline small icon"></i>\n          <div class="content">\n            ${t.Comment}\n          </div>\n        </h4>\n        <h4 class="ui right floated header">\n          <i title="${Object(E.b)("action:closewin")}" class="share-annotation window close small icon"></i>\n        </h4>\n      `:`\n        <h4 class="ui left floated header">\n          <i title="${Object(E.b)("action:fbshare")}" class="share-annotation facebook small icon"></i>\n          <i title="${Object(E.b)("action:emailshare")}" class="share-annotation envelope outline small icon"></i>\n          <i data-clipboard-text="${c}" title="${Object(E.b)("action:cp2clip")}" class="share-annotation linkify small icon"></i>\n          <div class="content">\n            ${t.Comment}\n          </div>\n        </h4>\n        <h4 class="ui right floated header">\n          <i title="${Object(E.b)("action:closewin")}" class="share-annotation window close small icon"></i>\n        </h4>\n      `;for(let e=0;e<p.length;e++)0===e?$(`#p${p[e]}`).addClass("selected-annotation clearBoth"):$(`#p${p[e]}`).addClass("selected-annotation");$(".selected-annotation").wrapAll("<div class='selected-annotation-wrapper ui clearing raised segment'></div>"),$(".selected-annotation-wrapper").prepend(s),"xxx"!==a.userId&&K.a.register(".share-annotation.linkify")})),V(),$(".transcript").on("click","#annotation-form .annotation-delete",(function(e){e.preventDefault(),me();let t=ce();be();let a=Z;a.length>0&&(t.links=a),Ct.delete(t),$(".transcript .annotation-edit").removeClass("annotation-edit")})),$(".transcript").on("click","[data-annotation-id]",(function(e){e.preventDefault();let t=$(this).attr("data-annotation-id"),a=$(this).parent("p").attr("id");if(void 0===a&&(a=$(this).parents("p").attr("id")),pe(a)||de())return;if($(".transcript").hasClass("hide-bookmark-highlights"))return;if($(".transcript").hasClass("topic-filter-active")&&!$(this).hasClass("show"))return;if($(this).hasClass("shared"))return;$(this).popup("hide"),$(this).addClass("show");let n=Fe(a).bookmark.find(e=>e.aid===t);ue(a,t,n)})),$(".transcript").on("click","p.cmiTranPara > span.pnum",(function(e){e.preventDefault();let t=$(this).parent("p").attr("id");if(pe()||de())return;let a=Fe(t);if(a.bookmark){let e=a.bookmark.find(e=>void 0===e.aid);if(e)return void ue(t,void 0,e)}fe(),$(`#${t}`).addClass("annotation-edit annotation-note"),$(".annotation-edit").wrapAll(oe),$(".annotate-wrapper").prepend(X()),$e(t)})),$(".transcript").on("mouseenter","[data-annotation-id]",(function(e){e.preventDefault();let t=$(this).attr("data-annotation-id"),a=$(this).parent("p").attr("id"),n=$(this).data("aid");if($(".transcript").hasClass("hide-bookmark-highlights"))return void $(this).popup("hide").popup("destroy");if($(".transcript").hasClass("topic-filter-active")&&!$(this).hasClass("show"))return void $(this).popup("hide").popup("destroy");if($(`#${a}`).hasClass("annotation-edit"))return void $(`#${a} [data-annotation-id]`).each((function(){$(this).popup("hide").popup("destroy")}));if($(`#${a}`).hasClass("selected-annotation"))return void $(`#${a} [data-annotation-id]`).each((function(){$(this).popup("hide").popup("destroy")}));if($(this).hasClass("shared"))return void $(this).popup("hide").popup("destroy");let o=Fe(a);if(!o.bookmark)return;let i=o.bookmark.find(e=>e.aid===t);if(!i)return;let r=ie(i.topicList),l=le(i.Comment),s=re(i);$(".annotation-information .topic-list").html(r),$(".annotation-information .range").html(`${Object(E.b)("label:range")}: ${i.rangeStart}/${i.rangeEnd}`),$(".annotation-information .description").html(`${l}`),$(".annotation-information .extra").html(s),$(this).popup({popup:".annotation-information.popup",hoverable:!0}).popup("show");let c=he(a,n);$("#popup-button").attr("data-clipboard-text",c),K.a.register("#popup-button"),$("#popup-button").focus()})),$(".transcript").on("click","#annotation-form .annotation-note",(function(e){e.preventDefault(),console.log("note button clicked");let t=$(".note-and-links");t.hasClass("hide")?t.removeClass("hide"):t.addClass("hide")})),ne(),$("body").on("click","#popup-button",(function(e){$("mark.visible").popup("hide"),$(".pnum.has-annotation.visible").popup("hide")})),$(".transcript").on("mouseenter",".has-annotation",(function(e){if(e.preventDefault(),$(".transcript").hasClass("hide-bookmark-highlights"))return void $(this).popup("hide").popup("destroy");let t=$(this).data("aid"),a=$(this).parent("p").attr("id"),n=Fe(a);if(!n.bookmark)return;let o=n.bookmark.find(e=>e.creationDate===t);if(!o)return;let i=ie(o.topicList),r=le(o.Comment),l=re(o);$(".annotation-information .topic-list").html(i),$(".annotation-information .range").html(`${Object(E.b)("label:range")}: ${o.rangeStart}/${o.rangeEnd}`),$(".annotation-information .description").html(`${r}`),$(".annotation-information .extra").html(l),$(this).popup({popup:".annotation-information.popup",hoverable:!0}).popup("show");let s=he(a,t);$("#popup-button").attr("data-clipboard-text",s),K.a.register("#popup-button"),$("#popup-button").focus()}))}function be(){$(".annotate-wrapper > form").remove(),$(".annotate-wrapper > .note-and-links").remove(),$(".annotation-edit").unwrap()}function $e(e,t,a){Qe.fetchTopics().then(n=>{let o=(i=n.topics,`\n    <select name="topicList" id="annotation-topic-list" multiple="" class="search ui dropdown">\n      <option value="">${Object(E.b)("label:selecttopic")}</option>\n      ${i.map(e=>`${function(e){return"object"==typeof e?`<option value="${e.value}">${e.topic}</option>`:`<option value="${e}">${e}</option>`}(e)}`).join("")}\n    </select>\n  `);var i;$("#available-topics").html(o),$("select.dropdown").dropdown(),se(e,t,a)}).catch(e=>{console.error("topic fetch error: ",e),o.a.error(`${Object(E.b)("annotate:m12")}: ${e}`)})}var ke=a(79),ve=a.n(ke),ye=a(40),xe=a.n(ye);let we=new Map,Ie=!0,Ce=[];function je(){let e=we,t=Array.from(e.keys()).map(t=>e.get(t));return t.sort((e,t)=>e.value<t.value?-1:e.value>t.value?1:0),function(e){return`\n    <select name="pageTopicList" id="page-topics-topic-list" class="search ui dropdown">\n      ${e.map(e=>`${function(e){return"object"==typeof e?`<option value="${e.value}">${e.topic}</option>`:`<option value="${e}">${e}</option>`}(e)}`).join("")}\n    </select>\n  `}(t)}function Te(){if(Ce.length>0){let e=$("#topic-menu-item").prev(".header").attr("data-filter");if("none"===e)return;Ce.reduce((t,a)=>a.topic===e?t+1:t,0)>0&&($(".transcript").removeClass("topic-filter-active"),$("#topic-menu-item").prev(".header").text(`${Object(E.b)("label:topicfilter")}: None`),$("#topic-menu-item").prev(".header").attr("data-filter","none"))}}function Oe(e){let t=e.value;if(we.has(t)){let e=we.get(t);e.count+=1,we.set(t,e)}else e.count=1,we.set(t,e),Ie=!0}function Se(e){let t=e;if("object"==typeof t&&(t=t.value),!we.has(t))throw new Error(`Unexpected error: topic ${t} not found in topic Map`);{let e=we.get(t);1===e.count?(we.delete(t),Ie=!0,Ce.push(e)):(e.count-=1,we.set(t,e))}}var Ee={add(e){e.selectedText&&e.topicList&&e.topicList.length>0&&e.topicList.forEach(e=>{Oe(e)})},delete(e){e.topicList&&e.topicList&&e.topicList.length>0&&(e.topicList.forEach(e=>{Se(e)}),Te())},addTopics(e){e.forEach(e=>{Oe(e)}),Te()},deleteTopics(e){e.forEach(e=>{Se(e)}),Te()},bookmarksLoaded(){$("#page-topics-modal").modal({dimmerSettings:{opacity:.5},autofocus:!1,centered:!0,duration:400,inverted:!0,observeChanges:!0,transition:"horizontal flip",onShow:function(){!function(){if(!Ie)return;let e=je();$("#page-topics-modal-topic-select").html(e),$("#page-topics-topic-list").dropdown(),$("#page-topics-modal-loading").removeClass("active").addClass("disabled"),Ie=!1}()},onVisible:function(){},onHidden:function(){}}),$("#page-topics-modal-open").on("click",e=>{e.preventDefault(),$("#page-topics-modal").modal("show")}),$("#page-topics-filter-submit").on("click",(function(e){e.preventDefault();let t=$("#page-topics-filter-form").form("get value","pageTopicList");!function(e){if($(".transcript").hasClass("topic-filter-active")){let t=$("#current-topic-filter").attr("data-filter");if(t===e.value)return;$(`mark.bookmark-selected-text.${t}`).removeClass("show")}else $(".transcript").addClass("topic-filter-active");$(`mark.bookmark-selected-text.${e.value}`).addClass("show"),$("#current-topic-filter").html(`Topic Filter: <span class="red">${e.topic}</span>`),$("#current-topic-filter").attr("data-filter",e.value),$("#bookmark-dropdown-menu > span > i").eq(0).removeClass("green").addClass("yellow"),$("#page-topics-modal").modal("hide")}({value:t,topic:$(`#page-topics-topic-list > [value='${t}']`).text()})})),$(".page-topics-filter-reset").on("click",(function(e){if(e.preventDefault(),$(".transcript").hasClass("topic-filter-active")){let e=$("#current-topic-filter").attr("data-filter");$(`mark.bookmark-selected-text.${e}`).removeClass("show")}$(".transcript").removeClass("topic-filter-active"),$("#current-topic-filter").html(`${Object(E.b)("label:topicfilter")}: None`),$("#current-topic-filter").attr("data-filter",""),$("#bookmark-dropdown-menu > span > i").eq(0).removeClass("yellow").addClass("green")}))},getTopic(e){let t=we.get(e);return t?t.topic:null},report(){for(var[e,t]of we)console.log("%s: %s",e,t)}};const Le=a(101),De=a(166),Pe=a(167);let Ke={},_e=[];function Ne(){let e,t=0;if(0!==_e.length)for(let a of _e){let n=Ke[a];e||(e=document.getElementById(n.pid)),Ue(n,e),qe(n.id,t),t+=1}}function qe(e,t){$(`[data-annotation-id="${e}"]`).addClass(["colorClass1","colorClass2","colorClass3","colorClass4","colorClass5","colorClass6"][t%6])}function Be(e,t=0,a=null){let n=document.getElementById(e.pid);a&&a===e.pid?a&&(console.log("highlight of %s skipped due to share",a),_e.push(e.id)):(Ue(e,n),qe(e.id,t)),Ke[e.id]=e}function Ue(e,t=document.body){var a=e.id;if(e.target.source)for(var n=e.target.selector,o=0;o<n.length;o++){var i=n[o];switch(i.type){case"TextPositionSelector":if(0===document.querySelectorAll(`[data-annotation-id="${a}"]`).length){var r,l=document.createElement("mark");l.dataset.annotationId=a,e.aid&&(l.dataset.aid=e.aid),l.classList.add("bookmark-selected-text");try{r=Le.toRange(t,i),e.wrap=Pe(l,r)}catch(a){console.log("adjusting selector.end"),i.end--,r=Le.toRange(t,i),e.wrap=Pe(l,r)}}}}}function Me(e){$("div.transcript.ui").on("mouseup",(function(e){if(e.preventDefault(),$(this).hasClass("disable-selection"))return;if(document.getSelection().isCollapsed)return;let t=document.getSelection();0!==t.rangeCount&&(t.getRangeAt(0).collapsed||function(e){let t=e.startContainer.parentElement.localName,a=e.endContainer.parentElement.localName;if("span"===t)return o.a.info(Object(E.b)("error:e6")),void console.log("selection includes <p>");if("mark"===t||"mark"===a)return o.a.info(Object(E.b)("error:e7")),console.log("overlapping selections"),void location.hostname;let n=e.startContainer.parentElement.id,i=e.endContainer.parentElement.id;if(!n)return void console.log("selection parent element: %s",e.startContainer.parentElement.nodeName);if(!n.startsWith("p"))return void console.log("range does not start with <p>");let r=parseInt(n.substr(1),10);if(!ve()(r))return void console.log("Pid: %s !isFinite()");if(n!==i)return o.a.info(Object(E.b)("error:e8")),void console.log("multi paragraph selection: start: %s, end: %s",n,i);let l=document.getElementById(n),s=function(e,t=document.body){if(e.collapsed)return null;var a=Le.fromRange(t,e);Object.assign(a,{type:"TextPositionSelector"});var n=De.fromRange(t,e);return Object.assign(n,{type:"TextQuoteSelector"}),{type:"Annotation",title:$("#book-title").text(),url:location.pathname,pid:e.startContainer.parentNode.id,id:Object(g.a)(),target:{type:"SpecificResource",source:location.href,selector:[a,n]}}}(e,l);s&&(Ue(s,l),Ke[s.id]=s,pe((c=s).pid)||de()?Ct.cancel({aid:c.id}):(fe(),G(),$(`#${c.pid}`).addClass("annotation-edit"),$(".annotation-edit").wrapAll(oe),$(".annotate-wrapper").prepend(X()),$e(c.pid,c.id),$(`[data-annotation-id="${c.id}"]`).addClass("show")));var c}(t.getRangeAt(0)))})),ge(e)}var Ae={};function Fe(e){const t=Ae.keyInfo.genPageKey(),a=r.a.get(t);if(a&&e){let t=parseInt(e.substr(1),10)+1;if(a[t])return{bookmark:a[t]}}return{}}function Re(e,t){r.a.set(Ae.bm_list_store,e)}function He(e){return r.a.get(Ae.bm_list_store)}function ze(){Ae.keyInfo.getKeyInfo();let e=He();e&&(e.lastBuildDate=0,Re(e))}function Je(e,t){const a=Ae.keyInfo.genPageKey();let n=parseInt(e.rangeStart.substr(1),10)+1,o=r.a.get(a);if(e.creationDate){if(e.creationDate=parseInt(e.creationDate,10),!o[n])throw new Error(`Expected bookmark ${n} not found.`);let t=u()(o[n],t=>t.creationDate===e.creationDate);if(-1===t)throw new Error(`Did not find annotation ${e.creationDate} for pid ${n}`);if(p()(o[n][t],e))return;o[n][t]=e}else{let a;e.creationDate=t,e.selectedText?(a="highlight",e.selectedText.aid=t.toString(10),i=e.selectedText.id,l=e.selectedText.aid,$(`[data-annotation-id="${i}"]`).attr("data-aid",l)):a="note",e.links&&xt(e,a),o?o[n]?o[n].push(e):o[n]=[e]:o={[n]:[e]}}var i,l;r.a.set(a,o),ze()}var Qe={addToTopicList:function(e){let t=r.a.get(Ae.bm_topic_list),a=t.topics.concat(e);a.sort((e,t)=>{let a,n;return a=e.topic.toLowerCase(),n=t.topic.toLowerCase(),a<n?-1:a>n?1:0}),t.topics=a,r.a.set(Ae.bm_topic_list,t);let n=Object(f.b)();if(n){let t={userId:n.userId,sourceId:Ae.keyInfo.getKeyInfo().sourceId,topicList:e};s.a.post(`${O}/user/topics`,t).then(e=>{}).catch(e=>{})}return t},fetchTopics:function(){const e=Object(f.b)();let t=r.a.get(Ae.bm_topic_list);return new Promise((a,n)=>{if(!e)return t||(t={lastFetchDate:0,topics:[]},r.a.set(Ae.bm_topic_list,t)),void a(t);if(t&&t.lastFetchDate+72e5>Date.now())return void a(t);let o=Ae.keyInfo.getKeyInfo().sourceId.toString(10);s.a.get(`${O}/user/${e.userId}/topics/${o}`).then(e=>{e.data.lastFetchDate=Date.now(),r.a.set(Ae.bm_topic_list,e.data),a(e.data)}).catch(e=>{console.error("Error fetching topicList: ",e),n(e)})})},getAnnotation:function(e,t){const a=Ae.keyInfo.genPageKey();let n,o;if(e=parseInt(e.substr(1),10)+1,n=r.a.get(a),!n)throw new Error("Expected bookmark data not found in local storage");if(!n[e])throw new Error(`Expected annotations not found for pid ${e}`);return o=n[e].filter(e=>e.creationDate===t),o[0]},deleteAnnotation:function(e,t){const a=Ae.keyInfo.genPageKey(),n=Object(f.b)();if(n){let o=Ae.keyInfo.genParagraphKey(e,a);s.a.delete(`${S}/bookmark/annotation/${n.userId}/${o}/${t}`).then(()=>{console.log("deleted annotation: %s/%s/%s",n.userId,o,t)}).catch(e=>{throw new Error(e)})}return function(e,t){const a=Ae.keyInfo.genPageKey();e=parseInt(e.substr(1),10)+1;let n=r.a.get(a);if(!n)throw new Error("Expected bookmark data not found in local storage");let o=n[e];if(!o)return;return n[e]=o.filter(e=>e.creationDate!==parseInt(t,10)),r.a.set(a,n),ze(),n[e].length}(e,t)},postAnnotation:function(e){const t=Ae.keyInfo.genPageKey(),a=Object(f.b)();let n=Date.now();if(a){let i=m()(e);i.selectedText&&delete i.selectedText.wrap,i.selectedText&&!i.selectedText.aid&&(i.selectedText.aid=n.toString(10)),i.selectedText=JSON.stringify(i.selectedText);let r={userId:a.userId,bookmarkId:Ae.keyInfo.genParagraphKey(i.rangeStart,t),annotationId:i.creationDate?i.creationDate:n,annotation:i};s.a.post(`${S}/bookmark/annotation`,r).then(t=>{"OK"!==t.data.message?(console.error("not OK message: %s",t.data.message),o.a.error(t.data.message)):Je(e,n)}).catch(e=>{console.error(`Error saving annotation: ${e}`),o.a.error(Object(E.b)("error:e1")),console.log("postBody",r)})}else Je(e,n)},getBookmarks:function(){let e=Ae.keyInfo.genPageKey();const t=Object(f.b)();return new Promise((a,n)=>{if(t)s.a.get(`${S}/bookmark/query/${t.userId}/${e}`).then(t=>{if(t.data.response){let n={};t.data.response.forEach(e=>{let t=Ae.keyInfo.parseKey(e.id);for(let t of e.bookmark)t.selectedText&&(t.selectedText=JSON.parse(t.selectedText));n[t.pid]=e.bookmark}),Object.keys(n).length>0&&r.a.set(e,n),a(n)}}).catch(e=>{n(e)});else{const t=r.a.get(e);a(t)}})},queryBookmarks:function(e){const t=Object(f.b)(),a=Ae.keyInfo.getKeyInfo();return new Promise((n,o)=>{if(t){let i=He(a);if(i){let e=i.lastFetchDate+288e5;if(Date.now()<e&&i.lastBuildDate>0)return void n(i)}s.a.get(`${S}/bookmark/query/${t.userId}/${e}`).then(e=>{if(e.data.response){for(let t of e.data.response)for(let e of t.bookmark)e.selectedText&&(e.selectedText=JSON.parse(e.selectedText));let t=function(e,t){let a={};return e.data.response.forEach(e=>{let t=Ae.keyInfo.parseKey(e.id);a[t.pageKey]||(a[t.pageKey]={}),a[t.pageKey][t.pid]=e.bookmark}),a.lastFetchDate=Date.now(),a.lastBuildDate=Date.now(),Re(a,t),a}(e,a);n(t)}}).catch(e=>{o(e)})}else{let e=function(e){const t=He(e);if(t&&t.lastBuildDate>0)return t;let a=parseInt(e.sourceId,10),n={};return r.a.each((e,t)=>{t.startsWith(a)&&(n[t]||(n[t]={}),n[t]=e)}),n.lastBuildDate=Date.now(),Re(n,e),n}(a);n(e)}})}},Ve=a(80),We=a.n(Ve),Ye=a(81),Ge=a.n(Ye),Xe=a(8),Ze=a(41),et=a.n(Ze),tt=a(42),at=a.n(tt);let nt={};function ot(e,t){const a=nt.bm_modal_key;let n;switch(e){case"get":return n=r.a.get(a),n||(n={modal:{filter:!1}}),n;case"set":r.a.set(a,t);break;default:throw new Error("Invalid value for 'option' argument: use 'set' or 'get'")}}function it(e,t,a,n){if(0===t.length)return`\n      <div class="bookmark-item item"> \x3c!-- ${e} --\x3e\n        <i class="bookmark icon"></i>\n        <div class="content">\n          <div class="header">\n            <a href="${a}?bkmk=${e}">${Object(E.b)("label:para")}: ${e}</a>\n          </div>\n        </div>\n      </div> \x3c!-- item: ${e} --\x3e\n    `;return`\n    <div class="${n.reduce((e,t)=>"object"==typeof t?`${e} ${t.value}`:`${e} ${t}`,"")} bookmark-item item"> \x3c!-- ${e} --\x3e\n      <i class="bookmark icon"></i>\n      <div class="content">\n        <div class="header">\n          <a href="${a}?bkmk=${e}">${Object(E.b)("label:para")}: ${e}</a>\n        </div>\n        <div class="list">\n          ${t.map(e=>{return`\n            <div class="item"> \x3c!-- item: ${e.rangeStart}/${e.rangeEnd} --\x3e\n              <i class="right triangle icon"></i>\n              <div class="content">\n                <div class="header">\n                  ${t=e.topicList,t&&0!==t.length?`\n    <div class="ui horizontal bulleted list">\n      ${t.map(e=>`\n        <div class="item">\n          <em>${"object"==typeof e?e.topic:e}</em>\n        </div>\n      `).join("")}\n    </div>\n  `:Object(E.b)("annotate:m13")}\n                </div>\n                <div class="description">\n                  ${e.Comment?e.Comment:Object(E.b)("annotate:m7")}\n                </div>\n              </div>\n            </div> \x3c!-- item: ${e.rangeStart}/${e.rangeEnd} --\x3e\n          `;var t}).join("")}\n        </div>\n      </div>\n    </div> \x3c!-- item: ${e} --\x3e\n  `}function rt(e){return`\n    ${e.map(e=>`\n      <div class="item"> \x3c!-- item: ${e.title} --\x3e\n        <i class="file icon"></i>\n        <div class="content">\n          <div class="header">\n            ${function(e){let t=`${e.title}`;return e.subTitle&&(t=`${t}: ${e.subTitle}`),t}(e)}\n          </div>\n          <div class="list">\n            ${function(e,t){let a="";for(let n in e)if(!n.startsWith("tpList")){a+=it(`p${(parseInt(n,10)-1).toString(10)}`,e[n],t,e[`tpList${n}`])}return a}(e.bookmarks,e.url)}\n          </div>\n        </div>\n      </div>\n    `).join("")}\n  `}function lt(e){let t,a=!0,n=[],o=$(".cmi-bookmark-list").attr("data-lbd");if(o){if(o=parseInt(o,10),o===e.lastBuildDate)return;a=!1}$(".cmi-bookmark-list").attr("data-lbd",e.lastBuildDate);for(let t in e)"lastFetchDate"!==t&&"lastBuildDate"!==t&&n.push(nt.getPageInfo(t,e[t]));Promise.all(n).then(e=>{let{bookArray:n,topics:o}=function(e){let t={},a=[];e.forEach(e=>{t[e.bookId]||(t[e.bookId]={},t[e.bookId].bookId=e.bookId,t[e.bookId].bookTitle=e.bookTitle,e.subTitle&&(t[e.bookId].subTitle=e.subTitle),t[e.bookId].pages=[]);let a={pageKey:e.pageKey,title:e.title,url:e.url,bookmarks:e.data};e.subTitle&&(a.subTitle=e.subTitle),t[e.bookId].pages.push(a)}),e.forEach(e=>{t[e.bookId]&&(a.push(t[e.bookId]),delete t[e.bookId])});let n=[];a.forEach(e=>{e.pages.forEach(e=>{for(let t in e.bookmarks)if(e.bookmarks[t].length>0){let a=e.bookmarks[t].map(e=>e.topicList?e.topicList:[]),o=at()(et()(a),(e,t)=>e.value===t.value);e.bookmarks[`tpList${t}`]=o,n.push(o)}})});let o=et()(n).sort((e,t)=>e.value<t.value?-1:e.value>t.value?1:0),i=at()(o,(e,t)=>e.value===t.value);return{bookArray:a,topics:i}}(e);var i;t=0===(i=n).length?E.a`
      <h2 class="ui center aligned icon header">
        <i class="circular bookmark icon"></i>
        ${"bmlist:header"}
      </h2>
      <p>
        ${"bmlist:intro"}
      </p>
      <ul>
        <li>${"bmlist:item1"}</li>
        <li>${"bmlist:item2"}</li>
      </ul>
      <p>
        ${"bmlist:link"}
      </p>
    `:`\n    ${i.map(e=>`\n      <div data-bid="${e.bookId}" class="item"> \x3c!-- item: ${e.bookId} --\x3e\n        <div class="right floated content">\n          <div data-book="${e.bookId}" class="green ui small button">Open</div>\n        </div>\n        <i class="book icon"></i>\n        <div class="content">\n          <div class="${e.bookId}-header header">\n            ${e.bookTitle}\n          </div>\n          <div id="${e.bookId}-list" class="hide-bookmarks list">\n            ${rt(e.pages)}\n          </div>\n        </div>\n      </div> \x3c!-- item: ${e.bookId} --\x3e\n    `).join("")}\n  `,$(".cmi-bookmark-list").html(t);let r=function(e){return`\n    <label>Filter Topic(s)</label>\n    <select name="topicList" id="bookmark-topic-list" multiple="" class="search ui dropdown">\n      <option value="">${Object(E.b)("label:selecttopic")}</option>\n      ${e.map(e=>`${function(e){return"object"==typeof e?`<option value="${e.value}">${e.topic}</option>`:`<option value="${e}">${e}</option>`}(e)}`).join("")}\n    </select>\n  `}(o);$("#bookmark-modal-topic-select").html(r),$("#bookmark-topic-list").dropdown(),$("#bookmark-modal-loading").removeClass("active").addClass("disabled");let l=ot("get");$("[data-bid]").each((function(){let e={},t=$(this).data("bid");e.count=$(`[data-bid="${t}"] .bookmark-item`).length,e.header=$(`.${t}-header`).text().trim(),$(`.${t}-header`).text(`${e.header} (${e.count})`),l[t]=e})),a&&(ot("set",l),$(".cmi-bookmark-list").on("click","[data-book]",(function(e){e.stopPropagation();let t=$(this).attr("data-book"),a=$(`#${t}-list`);a.hasClass("hide-bookmarks")?(a.removeClass("hide-bookmarks"),$(this).text("Close").removeClass("green").addClass("yellow")):(a.removeClass("yellow").addClass("green hide-bookmarks"),$(this).text("Open").removeClass("yellow").addClass("green"))})),$(".bookmark-filter-submit").on("click",(function(e,t){e.preventDefault();let a=$("#bookmark-filter-form").form("get value","topicList"),n=new RegExp(`\\b(${a.join("|")})\\b`);if(0===a.length)return;$(".cmi-bookmark-list .bookmark-item").each((function(){$(this).attr("class").match(n)?$(this).removeClass("hide-bookmark-item"):$(this).addClass("hide-bookmark-item")}));let o=ot("get"),i=a.map(e=>({value:e,topic:$(`#bookmark-topic-list > [value='${e}']`).text()}));t||(o.modal.filter=!0,o.modal.topics=a,o.modal.fullTopic=i,ot("set",o)),$("[data-bid]").each((function(){let e=$(this).data("bid"),t=$(`[data-bid="${e}"] .bookmark-item.hide-bookmark-item`).length,a=o[e].count-t;$(`.${e}-header`).html(`${o[e].header} (<span class="bookmark-filter-color">${a}</span>/${o[e].count})`)}))})),$(".bookmark-filter-reset").on("click",(function(e){e.preventDefault(),$("#bookmark-filter-form").form("clear"),$(".cmi-bookmark-list .hide-bookmark-item.bookmark-item").each((function(){$(this).removeClass("hide-bookmark-item")}));let t=ot("get");$("[data-bid]").each((function(){let e=$(this).data("bid");$(`.${e}-header`).text(`${t[e].header} (${t[e].count})`)})),t.modal.filter=!1,delete t.modal.topics,ot("set",t)})),function(){let{modal:e}=ot("get"),t=$("#bookmark-filter-form");console.log("modal: ",e),e.filter&&(t.form("set value","topicList",e.topics),$(".bookmark-filter-submit").trigger("click",{init:!0}))}())}).catch(e=>{console.error(e)})}function st(){$(".bookmark.ui.modal").modal({dimmerSettings:{opacity:.5},autofocus:!1,centered:!0,duration:400,inverted:!0,observeChanges:!0,transition:"horizontal flip",onShow:function(){!function(){const{sourceId:e}=nt.keyInfo.getKeyInfo();Qe.queryBookmarks(e).then(e=>{console.log("calling populateModal()"),lt(e)}).catch(t=>{o.a.error(Object(E.b)("error:e4")),console.error("Error getting bookmarks for: %s from server",e,t)})}()},onVisible:function(){},onHidden:function(){}}),$(".bookmark-modal-open").on("click",e=>{e.preventDefault(),$(".bookmark.ui.modal").modal("show")})}var ct=function(e){nt=e,st()};const{getUrl:pt}=a(108),{getUrl:dt}=a(109),{getUrl:ut}=a(110),{getUrl:ht}=a(111),{getUrl:mt}=a(13),{getUrl:ft}=a(112),{getUrl:gt}=a(113);function bt(e){let t=function(e,t){let a;switch(e){case"acol":a=ht(t,!0);break;case"acim":a=dt(t,!0);break;case"acimoe":a=ut(t,!0);break;case"jsb":a=mt(t,!0);break;case"raj":a=ft(t,!0);break;case"wom":a=gt(t,!0);break;case"www":a=pt(t,!0);break;default:a="/invalid/source"}return a}(e.desc.source,e.key);return location.pathname===t?`#${e.desc.pid}`:`${t}?v=${e.desc.pid}`}let $t={};function kt(e){return`\n    ${e.map(e=>`\n      ${function(e){let t=JSON.parse(e.link),a=bt(t),n=`${t.desc.source}:${t.desc.book}:${t.desc.unit}`;return n=t.desc.question?`${n}:${t.desc.question}:${t.desc.pid}`:`${n}:${t.desc.pid}`,`<a class="item" href="${a}">${e.reference}[${n}]</a>`}(e)}\n    `).join("")}\n  `}function vt(e){if(e.topicList&&e.topicList.length>0){let t=e.topicList.reduce((e,t)=>"object"==typeof t?`${e} ${t.value}`:`${e} ${t}`,"");$(`[data-annotation-id="${e.aid}"]`).addClass(t)}}function yt(e,t){$(`#p${e} > span.pnum`).addClass("has-annotation").attr("data-aid",t.creationDate);let a=parseInt(t.rangeEnd.substr(1),10),n=e;do{$(`#p${n}`).addClass("note-style-bookmark"),n===e&&$(`#p${n}`).addClass("note-style-bookmark-start"),n===a&&$(`#p${n}`).addClass("note-style-bookmark-end"),n++}while(n<=a)}function xt(e,t){e.links&&$(`[data-aid="${e.creationDate}"]`).after(`<i data-link-aid="${e.creationDate}" data-type="${t}" class="small bm-link-list linkify icon"></i>`)}function wt(e){let t=m()(e);var a;t.rangeStart=t.rangeStart.trim(),t.rangeEnd=t.rangeEnd.trim(),t.rangeEnd.startsWith("p")||(t.rangeEnd=`p${t.rangeEnd}`),""===t.Comment&&delete t.Comment,""===t.Note&&delete t.Note,""===t.creationDate&&delete t.creationDate,""===t.aid?delete t.aid:(t.selectedText=(a=t.aid,Ke[a]),t.creationDate&&(t.selectedText.aid=t.creationDate.toString(10)),delete t.textId),0===t.topicList.length&&delete t.topicList,function(e){let t;if(!e.aid)return;if(!(e.topicList&&e.topicList.length>0))return;t=e.topicList.reduce((e,t)=>`${e} ${t.value}`,"");let a=[];t&&(t=t.trim(),a=t.split(" "));let n=$(`[data-annotation-id="${e.aid}"]`).attr("class").split(" "),o=n.findIndex(e=>"bookmark-selected-text"===e);o>-1&&n.splice(o,1);let i=n.findIndex(e=>e.startsWith("colorClass"));i>-1&&n.splice(i,1);let r=xe()(n,a),l=xe()(a,n);if(r.length>0){let t=r.join(" ");$(`[data-annotation-id="${e.aid}"]`).removeClass(t),Ee.deleteTopics(r)}if(l.length>0){let t=l.join(" ");$(`[data-annotation-id="${e.aid}"]`).addClass(t);let a=e.topicList.filter(e=>void 0!==l.find(t=>t===e.value));Ee.addTopics(a)}}(t),delete t.newTopics,delete t.hasAnnotation,Qe.postAnnotation(t)}function It(e,t){!function(e){Qe.getBookmarks().then(t=>{if(t){for(let a in t){let n=!1,o=a-1,i=0;for(const r of t[a])r.selectedText?(Be(r.selectedText,i,e),vt(r),xt(r,"highlight"),Ee.add(r),i++,n=!0):(yt(o,r),xt(r,"note"));n&&$(`#p${o} > span.pnum`).addClass("has-bookmark")}Ee.bookmarksLoaded()}}).catch(e=>{console.error(e),o.a.error(Object(E.b)("error:e2"))})}(e),Me(t),$(".toggle-bookmark-highlight").on("click",(function(e){e.preventDefault();let t=$(".transcript");t.hasClass("hide-bookmark-highlights")?(t.removeClass("hide-bookmark-highlights"),$(".toggle-bookmark-highlight").text("Hide Highlighted Text")):(t.addClass("hide-bookmark-highlights"),$(".toggle-bookmark-highlight").text("Show Highlighted Text"))})),$("#bookmark-toggle-disable-selection").on("click",(function(e){e.preventDefault();let t=$(".transcript");t.hasClass("disable-selection")&&t.hasClass("user")?(t.removeClass("disable-selection user"),$(".toggle-bookmark-selection").text(Object(E.b)("menu:m1")),r.a.set($t.bm_creation_state,"enabled")):(t.addClass("disable-selection user"),$(".toggle-bookmark-selection").text(Object(E.b)("menu:m2")),r.a.set($t.bm_creation_state,"disabled"))})),function(){let e=r.a.get($t.bm_creation_state);e&&"disabled"===e&&$("#bookmark-toggle-disable-selection").trigger("click")}(),function(e){$(".transcript").on("click","td.follow-link-item",(function(t){t.preventDefault();let a=$(this).parent("tr").attr("data-index"),n=e(a),o=JSON.parse(n.link);location.href=bt(o)}))}(ee),$(".transcript").on("click",".bm-link-list.linkify",(function(e){e.preventDefault();let t,a=$(this).attr("data-type"),n=$(this).parent("p").attr("id");"note"===a?t=parseInt($(this).prev("span").attr("data-aid"),10):"highlight"===a&&(t=parseInt($(this).prev("mark").attr("data-aid"),10));let o=Fe(n);if(!o.bookmark)return;let i=o.bookmark.find(e=>e.creationDate===t);if(!i)return;let r=kt(i.links);$(".bm-link-list-popup").html(r),$(this).popup({popup:".bm-link-info.popup",hoverable:!0,on:"click"}).popup("show")}));let a=Object(Xe.e)();a&&function(e,t){N=t,R(e)}(a,$t)}const Ct={submit(e){let t=function({newTopics:e}){let t=e.replace(/[^a-zA-Z0-9, ]/g,"");if(!t||""===t)return[];t=t.replace(/^,*/,""),t=t.replace(/,*$/,"");let a=t.split(",");return a=a.map(e=>e.trim()),a=a.map(e=>Ge()(e)),a=a.map(e=>/ /.test(e)?{value:e.replace(/ /g,""),topic:e}:{value:e,topic:e}),a}(e);if(t.length>0?function(e,t){Qe.fetchTopics().then(a=>{let n=We()(e,a.topics,(e,t)=>t.value?t.value===e.value:t===e.value);n.length>0&&(Qe.addToTopicList(n),t.topicList=t.topicList.concat(n),t.newTopics=n,wt(t))}).catch(e=>{throw new Error(`bookmark.js:addToTopicList() error: ${e}`)})}(t,e):wt(e),e.aid){if($(`#${e.rangeStart} > span.pnum`).addClass("has-bookmark"),""===e.creationDate){let t=Fe(e.rangeStart),a=0;t.bookmark&&t.bookmark.length>0&&(a=t.bookmark.reduce((t,a)=>(a.aid&&a.aid!==e.aid&&(t+=1),t),0)),qe(e.aid,a)}}else{$(`#${e.rangeStart} > span.pnum`).addClass("has-annotation");let t=parseInt(e.rangeEnd.substr(1),10),a=parseInt(e.rangeStart.substr(1),10),n=a;do{$(`#p${a}`).addClass("note-style-bookmark"),a===n&&$(`#p${a}`).addClass("note-style-bookmark-start"),a===t&&$(`#p${a}`).addClass("note-style-bookmark-end"),a++}while(a<=t)}},cancel(e){!e.creationDate&&e.aid&&function(e){if(!e)return;let t=Ke[e];t.aid||(t.wrap.unwrap(),delete Ke[e])}(e.aid)},delete(e){if(e.aid)!function(e){if(!e)return;let t=Ke[e];t&&(t.wrap.unwrap(),delete Ke[e])}(e.aid);else{$(`#${e.rangeStart} > span.pnum`).removeClass("has-annotation");let t=parseInt(e.rangeEnd.substr(1),10),a=parseInt(e.rangeStart.substr(1),10),n=a;do{$(`#p${a}`).removeClass("note-style-bookmark"),a===n&&$(`#p${a}`).removeClass("note-style-bookmark-start"),a===t&&$(`#p${a}`).removeClass("note-style-bookmark-end"),a++}while(a<=t)}e.links&&$(`i[data-link-aid="${e.creationDate}"]`).remove(),0===Qe.deleteAnnotation(e.rangeStart,e.creationDate)&&$(`#${e.rangeStart} > span.pnum`).removeClass("has-bookmark"),Ee.delete(e)}};var jt=function(e,t){$t=t,function(e){Ae=e}($t),$(".transcript").length&&It(e,t),ct(t)};let Tt,Ot={};function St(){$(".share-annotation-close").on("click",(function(e){e.preventDefault(),console.log("clearSharedAnnotation"),Tt.selectedText&&Tt.selectedText.wrap.unwrap(),$("#shared-annotation-wrapper > .header").remove(),$(".shared-selected-annotation").unwrap(),$(".selected-annotation").removeClass("shared-selected-annotation"),$(".bookmark-selected-text.shared").removeClass("shared"),Ne()}))}function Et(){let e=Object(Xe.d)();if(!e)return!1;let[t,a,n]=decodeURIComponent(e).split(":");if(!t)return!1;if(0===$(`#${t}`).length)return!1;let o=Ot.keyInfo.genParagraphKey(t);return Object(Xe.c)(),function(e,t){return new Promise((a,n)=>{s.a.get(`${S}/bookmark/${t}/${e}`).then(e=>{if(e.data.response.Item)for(let t of e.data.response.Item.bookmark)t.selectedText&&(t.selectedText=JSON.parse(t.selectedText));a(e.data.response)}).catch(e=>{n(e)})})}(o,n).then(e=>{if(!e.Item)return void Ne();let t=e.Item.bookmark.find(e=>e.creationDate.toString(10)===a);if(!t)return void Ne();let n=document.getElementById(t.rangeStart);t.selectedText&&Ue(t.selectedText,n),$(`[data-aid="${a}"]`).addClass("shared"),function(e){let t=[e.rangeStart,e.rangeEnd].map(e=>parseInt(e.substr(1),10)),a=k()(t[0],t[1]+1),n=`\n    <h4 class="ui header">\n      <i title="${Object(E.b)("action:close")}" class="share-annotation-close small window close icon"></i>\n      <div class="content">\n        ${e.Comment?e.Comment:Object(E.b)("annotate:m7")}\n      </div>\n    </h4>\n  `;for(let e=0;e<a.length;e++)$(`#p${a[e]}`).addClass("shared-selected-annotation");$(".shared-selected-annotation").wrapAll("<div id='shared-annotation-wrapper' class='ui raised segment'></div>"),$("#shared-annotation-wrapper").prepend(n),C()(document.getElementById("shared-annotation-wrapper"),{align:{top:.2}})}(t),Tt=t,St(),Object(Xe.b)()}).catch(e=>{Object(Xe.b)(),console.error(e)}),t}var Lt=function(e){return Ot=e,Et()},Dt=a(14),Pt=a(6);function Kt(e){let t;if("transcript"===e){t=Lt(Dt.a);let e=Dt.a.keyInfo.genPageKey();Object(Pt.d)(e).then(e=>{let t=`${e.source}<br/>${e.bookTitle}`;e.subTitle&&(t=`${t}<br/>${e.subTitle}`),t=`${t}<br/>${e.title}`,$("#transcript-page-info").html(t)})}jt(t,Dt.a),P(Dt.a)}},50:function(e,t,a){"use strict";var n=a(22),o=a.n(n),i=a(6),r=a(82),l=a.n(r),s=a(5),c=a.n(s);const p=a(13);function d(e,t,a,n){return`\n    <h3>${t[e]} (${n.length})</h3>\n    <div class="ui list">\n      ${n.map(e=>`\n        <div class="item">\n          <i class="book icon"></i>\n          <div class="content">\n            <div class="header">\n              ${function(e,t){return e[t.pageKey].title}(a,e)} (${e.m.length})\n            </div>\n            <div class="list">\n              ${e.m.map(t=>`\n                <div class="item">\n                  <i class="search icon"></i>\n                  <div class="content">\n                    <div class="header">\n                      <a href="${a[e.pageKey].url}?srch=${t.location}">Paragraph ${t.location.substr(1)}</a>\n                    </div>\n                    <div class="description">\n                      ${t.context}\n                    </div>\n                  </div>\n                  </div> \x3c!-- item --\x3e\n              `).join("")}\n            </div> \x3c!-- list --\x3e\n          </div>\n        </div>\n      `).join("")}\n    </div> \x3c!-- ui list --\x3e\n  `}function u(e){let t=p.getKeyInfo().keyLength,a=[],n=0;for(const o of e)a[n]?a[n].unit!==o.unit?(n++,a[n]={unit:o.unit,book:o.book,pageKey:o.key.substr(0,t),m:[{location:o.location,context:o.context}]}):a[n].m.push({location:o.location,context:o.context}):a[n]={unit:o.unit,book:o.book,pageKey:o.key.substr(0,t),m:[{location:o.location,context:o.context}]};return a}function h(e){let t=p.getKeyInfo().keyLength,a=e.map(e=>e.key.substr(0,t));return l()(a)}function m(e,t){const a=p.getBooks();let n=[];for(let t=0;t<a.length;t++){let o=a[t];if(e[o]){let t=h(e[o]);for(const e of t)n.push(Object(i.d)(e))}}Promise.all(n).then(n=>{let o="",i={},r={};for(const e of n){let{bookTitle:t,title:a,subTitle:n,url:o}=e;n&&(a=`${a}: ${n}`),i[e.pageKey]={title:a,url:o},r[e.bookId]||(r[e.bookId]=t)}let l={};for(let t of a)e[t]&&(l[t]=u(e[t]),o+=d(t,r,i,l[t]));$(".cmi-search-list").html(o),$("#search-results-header").html(`: <em>${t}</em>`),function(e,t,a,n,o,i){const r=p.getBooks();let l=p.getKeyInfo().keyLength;if(0===t)return;let s=[];for(const e of r)if(i[e])for(const t of i[e]){let e={key:t.key.substr(0,l),url:`/${t.book}/${t.unit}/`,location:t.location};s.push(e)}c.a.set("query-result-wom",{query:e,count:t,titleArray:a,pageInfo:n,data:o,flat:s})}(t,e.count,r,i,l,e)}).catch(e=>{console.error("Error: %s",e.message)})}var f=a(8),g=a(16),b=a.n(g),k=a(9),v=a.n(k);const y=a(13);function x(e,t){b()(document.getElementById(e),{align:{top:.2}},a=>{!function(e,t){console.log(`${e}: ${t}`)}(`scroll from search navigator ${t}(${e})`,a)})}class w{constructor(e,t,a,n){this.query=e,this.start=t,this.end=a,this.count=a-t+1,this.hits=n}setStart(e,t){this.current=e;let a=this.hits[e].location;t?setTimeout(x,250,a,"setStart(first)"):x(a,"setStart()"),this.setTitle()}setTitle(){let e=this.current-this.start+1,t=`Search for <em>${this.query}</em> (${e} of ${this.count})`;$(".search-navigator-header-query").html(t)}setPrevious(){if(this.start===this.end)return;let e=this.current-1;e<this.start&&(e=this.end),this.setStart(e)}setNext(){if(this.start===this.end)return;let e=this.current+1;e>this.end&&(e=this.start),this.setStart(e)}showCurrent(){let e=this.hits[this.current].location;b()(document.getElementById(e),{align:{top:.2}})}}function I(e){let t=c.a.get("search.jsb.result");if(!t)return void v.a.warning("There are no search results to show.");let a=y.genPageKey(),n=a.toString(10),o=y.decodeKey(a).bookId,i=t.titleArray[o];if(!t.pageInfo[a])return void v.a.warning(`There is no search result at ${e}`);let r,l=function(e,t,a){let n={current:-1,prev:-1,start:-1,end:-1,next:-1},o=!1;for(let i=0;i<a.length;i++)if(a[i].key===t)a[i].location===e&&(n.current=i),o?n.end=i:(n.start=i,n.end=i,o=!0,i>0&&(n.prev=i-1));else if(o){n.next=i;break}return n}(e,n,t.flat);if(-1===l.current)return void v.a.warning(`There is no search result at ${e}`);l.prev>-1?(r=`/t/jsb${t.flat[l.prev].url}?srch=${t.flat[l.prev].location}`,$(".search-navigator .previous-page").attr("href",r)):$(".search-navigator .previous-page").addClass("inactive"),l.next>-1?(r=`/t/jsb${t.flat[l.next].url}?srch=${t.flat[l.next].location}`,$(".search-navigator .next-page").attr("href",r)):$(".search-navigator .next-page").addClass("inactive"),l.start===l.end&&($(".search-navigator .previous-match").addClass("inactive"),$(".search-navigator .next-match").addClass("inactive")),$(".search-navigator-header-book").text(`${i} - ${t.pageInfo[a].title}`);let s=new w(t.query,l.start,l.end,t.flat);s.setStart(l.current,!0);let p=function(e,t,a,n,o){let i=0,r=new RegExp("(?:^|\\b)("+n+")(?:$|\\b|)","gim");for(let l=t;l<=a;l++){let t=e[l].location,a=document.getElementById(t);if(!a){i++;continue}let s=a.innerHTML;s=s.replace(/[\r\n]/gm," "),a.innerHTML="show"===o?s.replace(r,"<mark class='show-mark'>$1</mark>"):s.replace(r,"<mark class='hide-mark'>$1</mark>"),a.innerHTML===s&&(console.log('Regex did not match: "%s" for %s',n,t),i++)}return i}(t.flat,l.start,l.end,t.query,"show");p&&v.a.info(`Failed to hilight ${p} search results`),function(e){$(".search-navigator .previous-match").on("click",(function(t){t.preventDefault(),e.setPrevious()})),$(".search-navigator .next-match").on("click",(function(t){t.preventDefault(),e.setNext()})),$(".search-navigator .current-match").on("click",(function(t){t.preventDefault(),e.showCurrent()})),$(".search-navigator .close-window").on("click",(function(e){e.preventDefault(),$(".search-navigator-wrapper").addClass("hide-search-navigator"),$(".transcript").removeClass("search-navigator-active")}))}(s),$(".transcript").addClass("search-navigator-active"),$(".search-navigator-wrapper").removeClass("hide-search-navigator")}const C=Symbol("no_source"),j=Symbol("source_selected"),T=Symbol("searching"),O=Symbol("search_result"),S=Symbol("search_error"),E=Symbol("saved_search");function L(e,t,a,n){switch(e){case C:$(".ui.search.message").addClass("negative"),$(".search-message.header").text("Search Source Not Selected"),$(".search-message-body").html("<p>You forgot to select a search source.</p>");break;case j:$(".ui.search.message").removeClass("negative"),$(".search-message.header").text("Search Source"),$(".search-message-body").html(`<p>Searching from <em>${t}</em></p>`);break;case T:$("#search .ui.icon.input").addClass("loading"),$("#search input").attr("disabled",!0),$(".ui.search.message").addClass("purple"),$(".search-message.header").text("Search Started..."),$(".search-message-body").html(`<p>Searching for <em>${a}</em></p>`);break;case E:$(".search-message.header").text("Last Search Result"),$(".search-message-body").html(`<p>Search for <em>${a}</em> from <em>${t}</em> found ${n} matches</p>`);break;case O:$("#search .ui.icon.input").removeClass("loading"),$("#search input").attr("disabled",!1),$(".ui.search.message").removeClass("purple").removeClass("negative"),n>0&&$("#search input").val(""),$(".search-message.header").text("Search Result"),$(".search-message-body").html(`<p>Search for <em>${a}</em> found ${n} matches</p>`);break;case S:$("#search .ui.icon.input").removeClass("loading"),$("#search input").attr("disabled",!1),$(".ui.search.message").removeClass("purple").addClass("negative"),$(".search-message.header").text("Search Error"),$(".search-message-body").html(`<p>${t}</p>`)}}function D(){let e=Object(f.g)();e&&I(e)}function P(){$(".search.ui.modal").modal({dimmerSettings:{opacity:.5},observeChanges:!0,onShow:function(){0===$(".cmi-search-list > h3").length&&function(){const e=c.a.get("query-result-wom");if(!e)return;const t=p.getBooks();let a="";for(let n of t)e.data[n]&&(a+=d(n,e.titleArray,e.pageInfo,e.data[n]));$(".cmi-search-list").html(a),$(".search-message.header").text("Last Search Result"),$(".search-message-body").html(`<p>Search for <em>${e.query}</em> found ${e.count} matches</p>`),$("#search-results-header").html(`: <em>${e.query}</em>`)}()}}),$(".search-modal-open").on("click",e=>{e.preventDefault(),$(".search.ui.modal").modal("show")}),$("#search").submit((function(e){e.preventDefault();var t=$("#search .source").text(),a=$("#search input").val();0!==a.length&&(L(T,t,a),function(e){let t={query:e,width:30};o.a.post("https://d9lsdwxpfg.execute-api.us-east-1.amazonaws.com/latest/wom",t).then(a=>{L(O,"",e,a.data.count),a.data.count>0?m(a.data,t.query):v.a.info(`Search for ${e} didn't find any matches`),document.getElementById("search-input-field").focus()}).catch(e=>{console.error("search error: %o",e),L(S,e.message)})}(a))}))}t.a={initialize:function(){$(".transcript").length&&D(),P()}}},51:function(e,t,a){"use strict";var n=a(32),o=a.n(n);const i={element:"#source-homepage",popover:{title:"Title",description:"This is the homepage for <em>The Impersonal Life</em> by Joseph Benner in the Christ Mind Library.<br><br>Click on the book cover below to see the table of contents.",position:"bottom"}},r={element:"#masthead-title",popover:{title:"Navigation and Features",description:"<em>The Impersonal Life</em> is part of the Library of Christ Mind Teachings. On every page you can click on this banner to navigate to the Library's main page and see all available teachings.",position:"bottom"}},l={element:"[data-book='til']",popover:{title:"The Impersonal Life",description:"By Joseph S. Benner, originally published in 1914. Audio is available and offered by Barry Peterson.",position:"top"}},s={element:"#page-menu",popover:{title:"The Menu",description:"This is the page menu, it will stick to the top when the page is scrolled (when the tour is over) so it is always available. The menu on other pages is similar but may contain additional features.<br/><br/>A brief description of each menu option follows.",position:"bottom"}},c={element:".bookmark-modal-open",popover:{title:"List Bookmarks",description:"Display a list of bookmarks you have created and optionally filter by topic. You can quickly jump to any bookmark. Learn more about bookmarks in the documentation.",position:"bottom"}},p={element:".search-modal-open",popover:{title:"Search Through All Books",description:"Find topics of interest by searching through all ACIM books.",position:"bottom"}},d={element:"#quick-links-dropdown-menu",popover:{title:"Navigate to Another Teaching",description:"Quickly jump to one of the other teachings in the Library.",position:"bottom"}},u={element:"#help-menu",popover:{title:"Get Help and Learn About",description:"Learn about the Library and using the features of the site.",position:"bottom"}},h={element:".login-menu-option",popover:{title:"Sign In/Sign Out",description:"Create an account and sign in to the site. It's free and allows you to create bookmarks that you can share via Facebook and keep synchronized between devices.",position:"left"}},m={element:"[data-book='til']",popover:{title:"Display Table of Contents",description:"Click on any image to display and navigate to the volume contents.",position:"left"}},f={element:"#masthead-title",popover:{title:"Library of Christ Mind Teachings",description:"This page is part of the Teachings of Christ Mind Library. Click this link to navigate to the Library's Home page.",position:"bottom"}},g={element:"#src-title",popover:{title:"The Impersonal Life",description:"This page is from The Impersonal Life",position:"bottom"}},b={element:"#book-title",popover:{title:"Page Title",description:"This identifies the book and section or lesson of the content on this page.",position:"bottom"}},k={element:"#bookmark-dropdown-menu",popover:{title:"Bookmarks",description:"You can create a bookmark from highlighted text and associate the bookmark with one or more categories. Learn more about bookmarks by reading the documentation.",position:"right"}},v={element:".search-modal-open",popover:{title:"Search Through All Books",description:"Find topics of interest by searching through all ACIM books.",position:"bottom"}},y={element:".audio-player-toggle",popover:{title:"Listen to the Audio",description:"Click the speaker icon to display the audio player and listen along as you read.",position:"bottom"}},x={element:".toggle-paragraph-markers",popover:{title:"Show/Hide Paragraph Markers",description:"Show or hide the markers that preceed each paragraph.",position:"bottom"}},w={element:".top-of-page",popover:{title:"Go To Top of Page",description:"Quickly jump to the top of the page.",position:"bottom"}},I={element:"#contents-modal-open",popover:{title:"Table of Contents",description:"View the table of contents.",position:"bottom"}},C={element:".previous-page",popover:{title:"Previous Page",description:"Go to the previous page. This will be disabled when the first page is displayed.",position:"bottom"}},j={element:".next-page",popover:{title:"Next Page",description:"Go to the next page. This will be disabled when the last page is displayed.",position:"bottom"}},T={element:"#about-dropdown-menu",popover:{title:"Get Help",description:"Learn how to use features of the Library.",position:"bottom"}},O={element:".login-menu-option",popover:{title:"Sign In/Sign Out",description:"Create an account and sign in or sign out. When you sign in, bookmarks you create will be available on all devices you use to access the library.",position:"bottom"}};var S=a(13),E=a.n(S),L=a(11);function D(){$("#help-menu").on("click","div.item",(function(e){e.preventDefault(),$(this).hasClass("page-tour")&&function(){const e=new o.a({allowClose:!1,opacity:.5});e.defineSteps([i,l]),e.start()}(),$(this).hasClass("page-navtour")&&function(){const e=new o.a({allowClose:!1,opacity:.5});let t=[];t.push(r),t.push(s),t.push(c),$(".search-modal-open").length>0&&t.push(p),t.push(d),t.push(u),t.push(h),t.push(m),e.defineSteps(t),e.start()}(),$(this).hasClass("transcript-tour")&&function(){const e=new o.a({allowClose:!1,opacity:.5});let t=[];t.push(f),t.push(g),t.push(b),t.push(k),$(".search-modal-open").length>0&&t.push(v),$(".audio-player-toggle").hasClass("hide")||t.push(y),t.push(x),t.push(w),$("#contents-modal-open").length>0&&(t.push(I),t.push(C),t.push(j)),t.push(d),t.push(T),t.push(O),e.defineSteps(t),e.start()}(),$(this).hasClass("about-src")&&(location.href="/about/"),$(this).hasClass("read-documentation")&&(location.href="/acq/quick/"),$(this).hasClass("view-documentation")&&(location.href="/acq/video/"),$(this).hasClass("contact-me")&&(location.href="/acq/contact/"),$(this).hasClass("profile-management")&&(location.href="/profile/email/")})),$("#quick-links").on("click","div.item",(function(e){e.preventDefault();let t=$(this).attr("data-href");location.href=t}))}t.a={initialize(){if(D(),$(".copy-page-key").length>0){let e=E.a.genPageKey();$(".copy-page-key").attr("data-clipboard-text",e).text(`Key: ${e}`),L.a.register(".copy-page-key")}}}},513:function(e,t,a){"use strict";a.r(t);var n=a(8),o=a(4),i=()=>{$.ajax({url:"//connect.facebook.net/en_US/sdk.js",dataType:"script",cache:!0,success:function(){FB.init({appId:"448658485318107",xfbml:!0,version:"v3.0"})}})},r=a(38),l=a(6),s=a(49),c=a(50),p=a(39),d=(a(425),a(429),a(432),a(434),a(435),a(437),a(438),a(440),a(441),a(443),a(444),a(446),a(447),a(449),a(450),a(452),a(9)),u=a.n(d),h=a(16),m=a.n(h),f=a(83),g=a.n(f),b=a(200),k=a.n(b);class v{constructor(e){this.data={base:e,time:[]},this.player=null}setPlayer(e){this.player=e}setData(e){this.data=e}setTimeArray(e){this.data.time=e}add(e){return this.data.time.push(e),this.data.time.length}remove(e){let t=g()(this.data.time,{id:e.id});return-1===t?-1:(this.data.time.splice(t,1),this.data.time.length)}length(){return this.data.time.length}getData(){return this.data}}var y=a(5),x=a.n(y);let w,I,C=!1,j=!1,T=!1,O=!1,S="",E="bullseye";let L=null,D=!1,P=!1;function K(){return new Promise((e,t)=>{D?D&&P?e(!0):$(".time-edit-modal.ui.modal").modal({dimmerSettings:{opacity:.5},closable:!1,onDeny:function(){e(!1)},onApprove:function(){if($("p.cmiTranPara").length!==L.length)return u.a.error("Unexpected number of data points in existing timing data, please inform Rick, Can't capture time until this is resolved."),void e(!1);M(),z=!1,P=!0,e(!0)}}).modal("show"):e(!0)})}function _(e){"SAVE"===e?x.a.set(`$captureData-${location.pathname}`,w.getData()):"REMOVE"===e&&x.a.remove(`$captureData-${location.pathname}`)}function N(e,t=!0){O=!0,q(e,t)}function q(e,t=!0){var a=$("#"+e.id).children("i.timing");O&&(a.hasClass(E)?(a.removeClass(E).addClass("check"),w.add(e),t&&_("SAVE")):a.hasClass("bullseye")?(a.removeClass("bullseye").addClass("check"),w.add(e),t&&_("SAVE")):a.hasClass("check")&&(a.removeClass("check").addClass("bullseye"),w.remove(e),t&&_("SAVE")),O=!1)}function B(){let e=x.a.get(`captureData-${location.pathname}`);if(e){C=!0,w.setData(e),$("#captured-audio-data").html(JSON.stringify(e));let t=Object(o.b)();return t&&($("#captured-audio-name").val(t.name),$("#captured-audio-email").val(t.email)),$(".timecapture.ui.modal").modal("show"),!0}return!1}function U(){let e=$(".transcript.ui.text.container");e.hasClass("hide-timing")?K().then(t=>{t&&e.removeClass("hide-timing")}):e.addClass("hide-timing")}function M(){B()||function(){let e=x.a.get(`$captureData-${location.pathname}`);if(e){x.a.remove(`$captureData-${location.pathname}`);for(let t in e.time)N(e.time[t]);let t=e.time[e.time.length-1];return I.setCurrentTime(t.seconds),u.a.info("Partial audio capture data restored. You can continue timing where you left off."),m()(document.getElementById(t.id)),!0}return!1}()||D||N({id:"p0",seconds:0},!1)}var A={initialize:function(e,t){console.log("capture.init"),t&&(D=!0,E="clock"),w=new v(location.pathname),w.setPlayer(e),I=e,$(".transcript.ui.text.container").addClass("hide-timing"),$("p.cmiTranPara").each((function(){$(this).prepend(`<i class='timing large circular red ${E} outline icon'></i>`)})),$(".transcript.ui.text.container").on("click","p.cmiTranPara > i.timing.icon",(function(e){e.preventDefault(),T?(O=!0,S=e.target.parentElement.id):u.a.info("Click is ignored when audio is not playing.")})),$(".timecapture.ui.modal").modal({dimmerSettings:{opacity:.5},closable:!1,onHide:function(){if(!C&&!j)return u.a.warning("Warning, your timing data will be lost if you close the window without submitting the data.","Your Data Will Be Lost",{timeOut:1e4,closeButton:!0}),j=!0,!1}}),$("#audio-data-form").submit((function(e){e.preventDefault(),C=!0;let t=$(this);$.post(t.attr("action"),t.serialize()).done((function(){u.a.success("Thank you! The data was submitted successfully."),$(".timecapture.ui.modal").modal("hide"),U(),x.a.remove(`captureData-${location.pathname}`)})).fail((function(e){u.a.error("Sorry, submit failed."),$("#audio-data-form .ui.message").addClass("negative").html('<div class="header">Drat! Your submit failed.</div>\n           <p>To re-submit, try to refresh the page or return at a later time.\n           The data will not be lost. This form will be displayed the next\n           time you visit the page.</p>'),$("#audio-form-submit").addClass("disabled"),x.a.set(`captureData-${location.pathname}`,w.getData())}))})),t?x.a.get(`$captureData-${location.pathname}`)?u.a.info("You have an incomplete timing session. Start time capture to begin where you left off."):x.a.get(`captureData-${location.pathname}`)&&(u.a.info("You have a complete but unsubmited timing session. Please send us the data."),B()):M()},toggleMarkers:U,play:function(){T=!0},pause:function(){T=!1},ended:function(){if(T=!1,D&&!P)return;if(!D&&1===w.length())return void _("REMOVE");let e=w.getData();P&&L.length!==e.time.length&&(e.time.forEach(e=>{let t=parseInt(e.id.substr(1),10);L[t]?(L[t].prevTime=L[t].seconds,L[t].seconds=e.seconds):(e.somethingFunny=!0,L.push(e))}),e.time=L),_("REMOVE");let t=$("p.cmiTranPara").length;t!==e.time.length&&$("#captured-audio-comments").val(`Incomplete data, there is data for ${e.time.length} of ${t} paragraphs`),$("#captured-audio-data").val(JSON.stringify(e));let a=Object(o.b)();a?($("#captured-audio-name").val(a.name),$("#captured-audio-email").val(a.email),$(".timecapture.ui.modal").modal("show")):$(".timecapture.ui.modal").modal("show")},setCurrentPlaybackTime:function(e){O&&q({id:S,seconds:e})}};let F=null,R=null,H=null,z=!0;const J=new class{constructor(e=-1,t=-1){this.val=e,this.pval=t}get ptrVal(){return this.val}set ptrVal(e){this.val=e}get pVal(){return this.pval}set pVal(e){this.pval=e}set inc(e=1){this.val=this.val+e}}(-1,-1);let Q,V=!1,W=!1;function Y(e){let t,a;switch(e){case"NEXT":J.val+1<F.length&&(t=X(J.val+1),Z(J.val+1),Q.setCurrentTime(t));break;case"PREV":J.val-1>=0&&(t=X(J.val-1),Z(J.val-1),Q.setCurrentTime(t));break;default:a=parseInt(e.substr(1),10),t=X(a),t>-1&&(Z(a),Q.setCurrentTime(t),Q.paused&&Q.play())}}function G(e){return Math.round(100*e)/100}function X(e){return e<0||e>=F.length?86400:F[e].seconds}function Z(e){J.val=e,ee(J.val)}function ee(e){var t=F[e];z&&m()(document.getElementById(t.id)),J.pval>-1&&$("#"+F[J.pval].id).removeClass("hilight"),$("#"+t.id).addClass("hilight"),J.pval=e,R&&R({pid:t.id,startTime:t.seconds,nextStartTime:e<F.length?F[e+1].seconds:Q.duration})}var te=function(e,t,a){Q=t,Object(l.a)(e).then(e=>{F=k()(e.time,(function(e){return e.seconds=G(e.seconds),e})),$(".transcript.ui.text.container").addClass("hide-playmark"),$("p.cmiTranPara").each((function(){$(this).prepend("<i class='playmark play icon'></i>")})),$(".transcript.ui.text.container").on("click","p.cmiTranPara > i.playmark.icon",(function(e){e.preventDefault(),Y($(this).parent().attr("id"))})),"TIMER"===a&&function(e){L=e}(F)}).catch(t=>{console.error("Failed to load timing data: %s, error: ",e,t)})},ae=function(e){var t;F&&(t=G(e),(-1===J.val||t>X(J.val+1))&&(J.inc=1,V||ee(J.val))),H&&H(e)},ne=function(){W&&(J.val=-1,J.pval=-1,V=!1,W=!1)},oe=function(){},ie=function(){F&&(W=!0,J.pval>-1&&$("#"+F[J.pval].id).removeClass("hilight"))};function re(e,t,a){let n=!1;a&&(te(a,e,t),$(".mejs__ptoggle").addClass("mejs-ptoggle-hidden")),"TIMER"===t&&(n=!0,A.initialize(e,a)),e.media.addEventListener("timeupdate",(function(){var t=e.getCurrentTime();a&&ae(t),n&&A.setCurrentPlaybackTime(t)})),e.media.addEventListener("playing",(function(){a&&ne(),n&&A.play()})),e.media.addEventListener("ended",(function(){a&&ie(),n&&A.ended()})),e.media.addEventListener("pause",(function(){a&&oe(),n&&A.pause()})),a&&(e.media.addEventListener("ptoggle",(function(){!function(){let e=$(".transcript.ui.text.container");return e.hasClass("hide-playmark")?(e.removeClass("hide-playmark"),!0):(e.addClass("hide-playmark"),!1)}()?$(".mejs__ptoggle").addClass("mejs-ptoggle-hidden").removeClass("mejs-ptoggle-visible"):$(".mejs__ptoggle").addClass("mejs-ptoggle-visible").removeClass("mejs-ptoggle-hidden")})),e.media.addEventListener("prevp",(function(){Y("PREV")})),e.media.addEventListener("nextp",(function(){Y("NEXT")}))),n&&e.media.addEventListener("capture",(function(){A.toggleMarkers()}))}function le(){let e=Object(o.b)();if(!e)return"LISTENER";if(!e.roles)return"LISTENER";let t=e.roles.find(e=>"timer"===e),a=e.roles.find(e=>"editor"===e);if(!t&&!a)return"LISTENER";let n=Object(l.e)(location.pathname);return n?n===e.email||a?"TIMER":"LISTENER":"TIMER"}var se=function(e,t){$("audio.mejs-player").attr("src",e);const{status:a,features:n}=function(e){let t={status:le(),features:[]};return"LISTENER"===t.status?t.features=e?["playpause","current","duration","prevp","nextp","ptoggle"]:["playpause","current","duration","skipback","jumpforward"]:t.features=e?["playpause","current","duration","prevp","nextp","ptoggle","capture","speed"]:["playpause","current","duration","skipback","jumpforward","capture","speed"],t}(t);$("#cmi-audio-player").mediaelementplayer({pluginPath:"/public/vendor/mediaelement/plugin/",skipBackInterval:15,jumpForwardInterval:15,timeFormat:"h:mm:ss",features:n,error:function(e){u.a.error("Audio error: ",e)},success:function(e,n,o){re(o,a,t)}})};var ce=function(){let e=Object(l.b)(location.pathname);e.audio&&(!function(e){$(".audio-player-toggle").attr("href",e)}(`${e.audioBase}${e.audio}`),$(".audio-player-toggle.hide").removeClass("hide"),$(".audio-player-toggle").on("click",e=>{e.preventDefault();let t=$(".audio-player-wrapper");t.hasClass("hide")?t.removeClass("hide"):t.addClass("hide")}),se(`${e.audioBase}${e.audio}`,e.timing))},pe=a(51),de=a(1),ue=a(14);$(document).ready(()=>{Object(de.c)(ue.a),Object(r.c)(),o.a.initialize(),i(),pe.a.initialize(),Object(l.f)(Object(p.b)()).then(e=>{c.a.initialize(),0!==e&&(p.a.initialize("transcript"),ce()),Object(n.f)(),Object(s.a)("transcript"),$(".disable-paragraph-marker").length>0&&(console.log("disable paragraph markers"),$(".toggle-paragraph-markers").eq(0).trigger("click"))}).catch(e=>{console.error(e)})})},6:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return h})),a.d(t,"f",(function(){return m})),a.d(t,"b",(function(){return f})),a.d(t,"e",(function(){return g})),a.d(t,"d",(function(){return b}));var n=a(5),o=a.n(n),i=a(22),r=a.n(i);const l={acq:"Mon Mar 18 14:23:19 WITA 2019",til:"Mon Mar 18 14:24:01 WITA 2019"},s=a(13);let c;function p(e){let t=l[e.bid];return e.saveDate?e.saveDate!==t&&(e.saveDate=t,console.log("%s needs to be refreshed",e.bid),!0):(e.saveDate=t,e.lastFetchDate&&delete e.lastFetchDate,console.log("%s needs to be refreshed",e.bid),!0)}function d(e){return r.a.get(e)}function u(e){return new Promise((t,a)=>{r.a.get(`/t/jsb/public/timing${e}`).then(e=>{t(e.data)}).catch(e=>{a(e)})})}function h(e,t=!0){return new Promise((a,n)=>{let i,r=o.a.get(`config.jsb.${e}`);if(r&&!p(r))return t&&(c=r),void a(r);i=`/t/jsb/public/config/${e}.json`,d(i).then(n=>{n.data.saveDate=l[n.data.bid],o.a.set(`config.jsb.${e}`,n.data),t&&(c=n.data),a(n.data)}).catch(()=>{c=null,n(`Config file: ${i} is not valid JSON`)})})}function m(e){return new Promise((t,a)=>{let n,i=o.a.get(`config.jsb.${e}`);if(i&&!p(i))return c=i,void t("config read from cache");n=`/t/jsb/public/config/${e}.json`,d(n).then(a=>{a.data.saveDate=l[a.data.bid],o.a.set(`config.jsb.${e}`,a.data),c=a.data,t("config fetched from server")}).catch(e=>{c=null,a(`Config file: ${n} is not valid JSON`)})})}function f(e){if(!c)throw new Error("Configuration has not been initialized");let t=(e=(e=e.substr(1)).substr(0,e.length-1)).split("/");if(c.bid!==t[2])throw new Error("Unexpected config file loaded; expecting %s but %s is loaded.",t[2],c.bid);let a,n={};return t[2],a=parseInt(t[3].substr(4),10)-1,n=function(e,t){let a;return a=c.contents[t],a||{}}(0,a),n.audioBase="https://s3.amazonaws.com/assets.christmind.info/jsb/audio",n}function g(e){let t=f(e);return t.timer?t.timer:null}function b(e,t=!1){let a=s.decodeKey(e),n={pageKey:e,source:"The Impersonal Life",bookId:a.bookId};return t&&(n.data=t),new Promise((e,t)=>{h(a.bookId,!1).then(t=>{n.bookTitle=t.title,a.hasQuestions?(n.title=t.contents[a.uid].title,n.subTitle=t.contents[a.uid].questions[a.qid].title,n.url=t.contents[a.uid].questions[a.qid].url):(n.title=t.contents[a.uid].title,n.url=t.contents[a.uid].url),e(n)}).catch(e=>{t(e)})})}},8:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return c})),a.d(t,"f",(function(){return p})),a.d(t,"e",(function(){return d})),a.d(t,"g",(function(){return u})),a.d(t,"d",(function(){return h})),a.d(t,"a",(function(){return m}));var n=a(10),o=a.n(n);function i(e,t){let a;a=t?t.substring(1):window.location.search.substring(1);let n=a.split("&");for(let t=0;t<n.length;t++){let a=n[t].split("=");if(a[0]===e)return a[1]}return null}function r(e,t){o()(document.getElementById(e),{align:{top:.2}},e=>{})}function l(){history.replaceState({},document.title,location.origin+location.pathname)}function s(){$("#transcript-page-loading").removeClass("active"),l()}function c(){i("as")&&$("#transcript-page-loading").addClass("active")}function p(){let e=i("v");e&&(setTimeout(r,250,e,"showParagraph"),l())}function d(){let e=i("bkmk");return e?(l(),e):null}function u(){let e=i("srch");return e?(l(),e):null}function h(){let e=i("as");return e||null}function m(){let e=i("user");return e?(l(),e):null}}});
//# sourceMappingURL=transcript.js.map