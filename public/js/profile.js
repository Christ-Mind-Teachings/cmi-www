!function(e){function t(t){for(var o,r,s=t[0],l=t[1],d=t[2],u=0,m=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&m.push(i[r][0]),i[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(c&&c(t);m.length;)m.shift()();return n.push.apply(n,d||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],o=!0,s=1;s<a.length;s++){var l=a[s];0!==i[l]&&(o=!1)}o&&(n.splice(t--,1),e=r(r.s=a[0]))}return e}var o={},i={3:0},n=[];function r(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=o,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(a,o,function(t){return e[t]}.bind(null,o));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/public/js";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var c=l;n.push([288,1,0]),a()}({288:function(e,t,a){e.exports=a(290)},290:function(e,t,a){"use strict";a.r(t);var o=a(3),i=a(21),n=a(29),r=a(30),s=a(24),l=a(4),d=a(31),c=a(1),u=a.n(c),m=a(25),p=a(12);let f=[];function h(){$("button.save-to-database").removeClass("disabled")}function v(){$("#email-list-table").on("click",".delete-maillist-item",(function(e){e.stopPropagation(),e.preventDefault();let t=$(this).parent(),a=parseInt(t.attr("data-index"),10);f[a].deleted=!0,t.remove(),h()})),$("#email-list-table").on("click","td.edit-maillist-item",(function(e){e.stopPropagation(),e.preventDefault();let t=parseInt($(this).parent().attr("data-index"),10);$("#addto-maillist-form").form("set values",f[t]),$("#add-or-update").text("Update").attr("data-index",t),$(".addto-maillist-dialog-wrapper.hide").removeClass("hide")})),$("button.add-name-to-maillist").on("click",(function(e){e.preventDefault(),e.stopPropagation(),$("#add-or-update").text("Add"),$(".addto-maillist-dialog-wrapper.hide").removeClass("hide")})),$("button.save-to-database").on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(".addto-maillist-dialog-wrapper").addClass("hide"),async function(){let e=Object(l.b)(),t=f.filter(e=>!e.deleted),a={userId:e.userId,mailList:t};try{$(".sync.icon").addClass("loading");let t=await Object(m.b)(e.userId,a);u.a.info(`Saved! ${t}`),$(".sync.icon.loading").removeClass("loading"),$("button.save-to-database").addClass("disabled")}catch(e){$(".sync.icon.loading").removeClass("loading"),u.a.error(e)}}()})),$("form[name='addtomaillist']").on("submit",(function(e){e.preventDefault(),e.stopPropagation();let t=$("#add-or-update").text(),a=$("#addto-maillist-form").form("get values");if(a.first=Object(p.a)(a.first),a.last=Object(p.a)(a.last),a.address=Object(p.a)(a.address),"Add"===t){f.push({first:a.first,last:a.last,address:a.address});let e=(o=a,`\n    <tr data-index="${f.length-1}">\n      <td class="delete-maillist-item"><i class="trash alternate icon"></i></td>\n      <td class="edit-maillist-item"><i class="pencil alternate icon"></i></td>\n      <td data-name="first">${o.first}</td>\n      <td data-name="last">${o.last}</td>\n      <td data-name="address">${o.address}</td>\n    </tr>\n  `);$("#email-list-table").append(e),h()}else{let e=parseInt($("#add-or-update").attr("data-index"),10);f[e]={first:a.first,last:a.last,address:a.address},$(`tr[data-index="${e}"] > td[data-name="first"]`).text(f[e].first),$(`tr[data-index="${e}"] > td[data-name="last"]`).text(f[e].last),$(`tr[data-index="${e}"] > td[data-name="address"]`).text(f[e].address),$(".addto-maillist-dialog-wrapper").addClass("hide"),h()}var o;$("#addto-maillist-form").form("clear")})),$(".addto-maillist-cancel").on("click",(function(e){e.preventDefault(),e.stopPropagation(),$(".addto-maillist-dialog-wrapper").addClass("hide")}))}var b=a(15),y=a(22),g=a(11),k=a(5),C=a.n(k),w=a(6);var x=a(47),D=a.n(x),I={title:{10:"The Way of Mastery",11:"The Impersonal Life",12:"ACIM Sparkley Edition",13:"The Raj Material",14:"A Course Of Love",15:"ACIM Original Edition",16:"Droga Mistrzostwa"},12:[{value:"*",name:"All Books"},{value:"122",name:"Text"},{value:"123",name:"Workbook for Students"},{value:"124",name:"Manual for Teachers"},{value:"121",name:"Preface"}],15:[{value:"*",name:"All Books"},{value:"151",name:"Text"},{value:"152",name:"Workbook for Students"},{value:"153",name:"Manual for Teachers"}],14:[{value:"*",name:"All Books"},{value:"1404",name:"The Course"},{value:"1402",name:"The Treatises"},{value:"1403",name:"The Dialogues"}],11:[{value:"*",name:"All Books"}],13:[{value:"*",name:"All Books"},{value:"1301",name:"You Are the Answer"},{value:"1302",name:"Graduation"},{value:"1303",name:"ACIM Study Group 2002"},{value:"1304",name:"ACIM Study Group 2003"},{value:"1305",name:"ACIM Study Group 2004"},{value:"1306",name:"ACIM Study Group 2005"},{value:"1307",name:"ACIM Study Group 2006"},{value:"1308",name:"ACIM Study Group 2007"},{value:"1309",name:"ACIM Study Group 2008"},{value:"1310",name:"ACIM Study Group 2009"},{value:"1311",name:"ACIM Study Group 2010"},{value:"1312",name:"ACIM Study Group 2011"},{value:"1313",name:"ACIM Study Group 2012"},{value:"1314",name:"ACIM Study Group 2013"},{value:"1315",name:"ACIM Study Group 2014"},{value:"1316",name:"ACIM Study Group 2015"},{value:"1317",name:"ACIM Study Group 2016"},{value:"1318",name:"ACIM Study Group 2017"},{value:"1319",name:"ACIM Study Group 2018"}],10:[{value:"*",name:"All Books"},{value:"101",name:"The Jeshua Letters"},{value:"102",name:"The Way of the Servant"},{value:"103",name:"The Early Years"},{value:"104",name:"The Way of the Heart"},{value:"105",name:"The Way of Transformation"},{value:"106",name:"The Way of Knowing"}],16:[{value:"*",name:"Wszystkie książki"},{value:"1601",name:"Listy Jeszuy"},{value:"1602",name:"Droga Sługi"},{value:"1606",name:"Wczesne lata Drogi"},{value:"1603",name:"Droga Serca"},{value:"1604",name:"Droga Przemiany"},{value:"1605",name:"Droga Poznania"}]};let A={},q={},T={};function j(e){let t=q[e];if($("#topicSelectNew").dropdown("clear"),!t)return void $("#topic-list-new").html("");let a=function(e){return`\n    <div class="item" data-value="*">** Show All Bookmarks</div>\n    ${e.map(e=>`${e.deleted?"":function(e){return`\n    <div class="item" data-value="${e.value}">${e.topic}</div>\n  `}(e)}`).join("")}\n  `}(t);$("#topic-list-new").html(a),$("#manageTopicsButton").removeAttr("disabled").attr("data-sid",e),$("#displayBookmarksButtonNew").removeAttr("disabled").attr("data-sid",e)}function O(e,t){let a=Object(b.b)(e);Promise.all(a).then(e=>{let a=function(e,t){return`\n    <p>\n      ${t.source}<br/>\n      ${e.length} Bookmarks include topics: <em>${t.topicArray.join(` ${t.condition} `)}</em> <br/>\n      ${(new Date).toLocaleString()}\n    </p>\n    ${e.map(e=>{return`${t=e,`\n    <div class="ui vertical segment bookmark-segment ${t.mgr.type}">\n      <div class="ui small header bookmark-header">\n        <a id="${t.annotation.creationDate}" target="_blank" href="${t.mgr.url}?v=${t.mgr.pid}&key=${t.paraKey}">${t.mgr.title?t.mgr.title:t.mgr.url}</a>\n        <br/>\n        <div class="ui horizontal bulleted link list">\n          ${function(e,t,a=!1){return e&&0!==e.length?`\n    ${e.map(e=>`\n      <div class="item">\n        <em>${a?e:`<a class="topic-summary ${e.summary?"summarized":""}" data-creationdate="${t.creationDate}" data-sid="${t.paraKey.substring(0,2)}" data-value="${e.value}" href="#">${e.topic}</a>`}</em>\n      </div>\n    `).join("")}\n  `:'\n      <div class="item">\n        <em>Annotation has no topics</em>\n      </div>\n    '}(t.annotation.topicList,t)}\n        </div>\n        ${t.mgr.comment?"<br/>":""}\n        ${t.mgr.comment?t.mgr.comment:""}\n      </div>\n      ${a=t.mgr.content,`\n    ${a.map(e=>`\n      <p>\n        ${e.text}\n      </p>\n    `).join("")}\n  `}\n      <p ${"note"!==t.mgr.type?`class='cmi-manage-quote ${t.annotation.quote?"in-database":""} ${t.annotation.creationDate}'`:""}>\n        ~${t.paraKey}${"note"===t.mgr.type?"":`:${t.annotation.creationDate}:${t.annotation.rangeStart}`}\n      </p>\n    </div>\n  `}`;var t,a}).join("")}\n  `}(e,t);$("#activity-report-controls").remove(),$("#activity-report").html(a)})}function S(e){"open"===e?(P(),$("#action-manager > .annotation-actions").addClass("hide"),$("#manageTopicsButton").text("Un-Manage Topics"),$("#topicTable").removeClass("hide")):"close"===e&&($("#manageTopicsButton").text("Manage Topics"),$("#topicTable").addClass("hide"))}function P(){$("#activity-report").html(""),$("#topicSelectNew").dropdown("clear"),$(".condition-checkbox.default").trigger("click"),$(".style-checkbox.default").trigger("click")}function M(){$(".style-checkbox.default").trigger("click"),$("#action-manager > .annotation-actions .hide-headers").hasClass("hide")&&($("#action-manager > .annotation-actions .hide-headers").removeClass("hide").html("Hide Headers"),$("#activity-report .bookmark-header").removeClass("hide")),$("#action-manager > .annotation-actions .hide-quotes").hasClass("hide")&&($("#action-manager > .annotation-actions .hide-quotes").removeClass("hide").html("Hide Quotes"),$("#activity-report .bookmark-segment.hide").removeClass("hide"),$("#activity-report .bookmark-segment.hide").removeClass("qhide"))}function L(){$("#topicSelectNew").dropdown(),$("#action-manager .ui.radio.checkbox").checkbox(),$("#condition-toggle").on("change",(function(e){let t=$("#condition-toggle label").text();$("#condition-toggle label").text("AND"===t?"OR":"AND")})),$("#manageTopicsButton").on("click",(function(e){let t=$(this).attr("data-sid");if($("#topicTable").hasClass("hide")){let e=function(e){return`\n    ${q[e].map((t,a)=>`\n      ${t.deleted?"":function(e,t,a){return`\n    <tr data-sid="${e}" data-index="${a}"> \n      <td class="edit-topic-item"><i class="pencil alternate icon"></i></td>\n      <td class="delete-topic-item"><i class="trash alternate icon"></i></td>\n      <td class="topic">${t.topic}</td>\n    </tr>\n  `}(e,t,a)}`).join("")}\n  `}(t);$("#topicTable > tbody").html(e),S("open")}else S("close")})),$("#topicTable").on("click","td.delete-topic-item",(function(e){let t=parseInt($(this).parent().attr("data-index"),10),a=$(this).parent().attr("data-sid");if($(this).parent().hasClass("deleted"))return void u.a.info("Topic has been deleted");let o=q[a][t];$("#confirmDelete > .header").text(`Delete Topic: "${o.topic}"?`),$("#confirmDelete .actions > .delete-approve").attr("data-sid",a),$("#confirmDelete .actions > .delete-approve").attr("data-index",t),$("#confirmDelete").modal("show")})),$("#topicTable").on("click","td.edit-topic-item",(function(e){let t=parseInt($(this).parent().attr("data-index"),10),a=$(this).parent().attr("data-sid");$(this).parent().hasClass("deleted")?u.a.info("Topic has been deleted"):($("#edit-topic-form").form("set values",{sid:a,index:t,topic:q[a][t].topic,oldtopic:q[a][t].topic}),$(".edit-topic-dialog-wrapper.hide").removeClass("hide"))})),$("#update-topic-cancel").on("click",(function(e){e.preventDefault(),$(".edit-topic-dialog-wrapper").addClass("hide")})),$("#update-topic-submit").on("click",(function(e){e.preventDefault();let t=$("#edit-topic-form").form("get values"),a=parseInt(t.index,10);if(t.topic===t.oldtopic)return void $(".edit-topic-dialog-wrapper").addClass("hide");let o=function(e){let t={},a=e.replace(/[^a-zA-Z0-9ąćęłńóśźżĄĆĘŁŃÓŚŹŻ, ]/g,"");return a&&""!==a?(a=a.trim(),a=D()(a),t=/ /.test(a)?{value:a.replace(/ /g,""),topic:a}:{value:a,topic:a},t):t}(t.topic);if(console.log("old Topic: %o, new Topic: %o",q[t.sid][a],o),q[t.sid].find(e=>e.value===o.value))return void u.a.info("That topic already exists.");_(t.sid,"topicList"),$(".edit-topic-dialog-wrapper").addClass("hide");let i=q[t.sid][a];q[t.sid][a]=o,$(`[data-sid='${t.sid}'][data-index='${t.index}'] > .topic`).text(o.topic),$(`#topic-list-new > [data-value='${i.value}']`).attr("data-value",o.value).text(o.topic),A[t.sid].forEach(e=>{if(e.annotation.topicList){let a=e.annotation.topicList.findIndex(e=>e.value===i.value);if(a>-1){let i=Object.create({}),n=e.annotation.topicList[a].summary;n&&(i.summary=n),i.value=o.value,i.topic=o.topic,e.annotation.topicList[a]=i,e.modified=!0,_(t.sid,"bookmark")}}})})),$("#displayBookmarksButtonNew").on("click",(function(e){e.preventDefault();let t=$(this).attr("data-sid"),a={},o=$("#action-manager").form("get values");if(0===o.topicListNew.length)return void u.a.info("Select one or more topics from the Topic Select List");S("close"),M();let i=$(`#book-list${t} :selected`).val(),n="on"===o.condition?"AND":"OR",r=function(e,t,a,o){let i=a.split(","),n=!i.includes("*"),r=[];return n?A[e].forEach(e=>{let t=e.annotation.topicList,a=0;if(t&&t.length>0){for(let n=0;n<i.length;n++){let s=t.findIndex(e=>e.value===i[n]);if("OR"===o){if(s>-1){r.push(e);break}}else s>-1&&a++}a===i.length&&"AND"===o&&r.push(e)}}):r=A[e],"*"!==t&&(r=r.filter(e=>e.paraKey.startsWith(t))),r}(t,i,o.topicListNew,n);0!==r.length?($("#action-manager > .annotation-actions").removeClass("hide"),a.source=I.title[t],a.topicArray=o.topicListNew.split(","),a.condition=n,a.bookFilter=i,a.sid=t,O(r,a)):u.a.info("No bookmarks contain selected topics")})),$("#action-manager > .annotation-actions input[type=radio][name=annotationFilter]").on("change",(function(e){let t=$("#action-manager").form("get values");"none"===t.annotationFilter?$(".bookmark-segment.hide").removeClass("hide"):"note"===t.annotationFilter?($(".bookmark-segment.note").removeClass("hide"),$(".bookmark-segment.selected").addClass("hide")):"selected"===t.annotationFilter&&($(".bookmark-segment.note").addClass("hide"),$(".bookmark-segment.selected").removeClass("hide"))})),$("#action-manager > .annotation-actions").on("click",".hide-quotes",(function(e){if($(this).hasClass("hide"))$(this).removeClass("hide").html("Hide Quotes"),$("#activity-report .bookmark-segment.qhide").removeClass("qhide");else{let e=$("#activity-report .cmi-manage-quote.in-database").parent();e.addClass("qhide"),$(this).addClass("hide").html(`Show Quotes (${e.length})`)}})),$("#action-manager > .annotation-actions").on("click",".hide-headers",(function(e){$(this).hasClass("hide")?($(this).removeClass("hide").html("Hide Headers"),$("#activity-report .bookmark-header").removeClass("hide")):($(this).addClass("hide").html("Show Headers"),$("#activity-report .bookmark-header").addClass("hide"))})),$("#confirmDelete").modal({closable:!1,onDeny:function(){u.a.info("Delete Canceled.")},onApprove:function(e){let t=parseInt($(e).attr("data-index"),10),a=$(e).attr("data-sid"),o=q[a][t];o.index=t,$(`#topicTable > tbody > [data-sid='${a}'][data-index='${t}']`).addClass("deleted"),$(`#topic-list-new > [data-value='${o.value}']`).addClass("deleted").attr("data-value","X"),q[a][t].deleted=!0,_(a,"topicList");let i=!1;A[a].forEach(e=>{if(e.annotation.topicList){let t=e.annotation.topicList.findIndex(e=>e.value===o.value);t>-1&&(e.annotation.topicList.splice(t,1),e.modified=!0,i=!0)}}),i&&_(a,"bookmark"),u.a.success(`Topic "${o.topic}" Deleted.`)}}),$("#applyChangesButtonNew").on("click",(function(){$(this).addClass("loading");let e=function(){let e=[],t=[];return Object.keys(T).forEach(a=>{if(!0===T[a].bookmark){A[a].filter(e=>e.modified).forEach(t=>{e.push(t)})}!0===T[a].topicList&&t.push(a)}),{bookmarks:e,topics:t}}(),t=Object(l.b)(),a=[];e.bookmarks.forEach(e=>{delete e.modified,delete e.pid,a.push(Object(g.e)(e))}),Promise.all(a).then(o=>(u.a.success(`${o.length} Annotation(s) Updated`),a=[],e.topics.forEach(e=>{let o=q[e].filter(e=>!e.deleted);a.push(Object(y.b)(t.userId,e,o))}),Promise.all(a))).then(e=>{u.a.success(`${e.length} topicList(s) Updated`),Object.keys(T).forEach(e=>{A[e].forEach(e=>{delete e.modified})}),T={},$("#applyChangesButtonNew").attr("disabled",""),u.a.success("Modifications Saved"),$(this).removeClass("loading")}).catch(e=>{u.a.error(`Error updating items: ${e}`),console.error(e),$(this).removeClass("loading")})}))}function B(e){let t=A[e.sid].find(t=>t.creationDate===e.creationDate);return t||(console.error("Couldn't find bookmark to summarize. This shouldn't happen."),u.a.error("Couldn't find bookmark to summarize.")),t}function z(e,t){let a=e.annotation.topicList.find(e=>e.value===t);return a||(console.error("Couldn't find topic to summarize. This shouldn't happen."),u.a.error("Couldn't find topic to summarize.")),a}function N(){$("#activity-report").on("click",".topic-summary",(function(e){if(e.stopPropagation(),e.preventDefault(),!Object(l.b)())return;if($("#activity-report").hasClass("topic-summary-editor-open"))return;$("#activity-report").addClass("topic-summary-editor-open");let t={};t.sid=$(this).attr("data-sid"),t.creationDate=$(this).attr("data-creationdate"),t.topicValue=$(this).attr("data-value"),$(this).addClass("selected"),$(this).parents(".bookmark-header").append('\n    <form name="topic-summary-editor" id="topic-summary-editor-form" class="ui form">\n      <input class="hidden-field" type="text" readonly name="creationDate">\n      <input class="hidden-field" type="text" name="sid" readonly>\n      <input class="hidden-field" type="text" name="topicValue" readonly>\n      <div class="field">\n        <label>Summarized Annotation</label>\n        <textarea name="summary" placeholder="No summary yet." rows="5"></textarea>\n      </div>\n      <div class="fields">\n        <button class="summary-submit ui green button" type="submit">Add or Update</button>\n        <button class="summary-cancel ui red basic button">Cancel</button>\n        <div class="twelve wide field">\n          <button class="summary-delete ui red disabled right floated button">Delete</button>\n        </div>\n      </div>\n    </form>\n  '),function(e){let t=$("#topic-summary-editor-form"),a=B(e);if(a){let t=z(a,e.topicValue);t&&t.summary&&(e.summary=t.summary,$("#topic-summary-editor-form .summary-delete").removeClass("disabled"))}t.form("set values",e)}(t)})),$("#activity-report").on("click","#topic-summary-editor-form .summary-cancel",(function(e){e.stopPropagation(),e.preventDefault(),$(this).parents(".bookmark-header").find(".topic-summary.selected").removeClass("selected"),E(),W()})),$("#activity-report").on("click","#topic-summary-editor-form .summary-submit",(function(e){e.stopPropagation(),e.preventDefault();let t=$("#topic-summary-editor-form").form("get values");if(t.summary=t.summary.trim(),E(),W(),0===t.summary.length)return void $(".bookmark-header .topic-summary.selected").removeClass("selected");t.summary=Object(p.a)(t.summary);let a=B(t);if(a){let e=z(a,t.topicValue);e&&(a.annotation.summarized=!0,e.summary=t.summary)}a.modified=!0,_(t.sid,"bookmark"),$(".bookmark-header .topic-summary.selected").addClass("summarized").removeClass("selected")})),$("#activity-report").on("click",".summary-delete",(function(e){e.stopPropagation(),e.preventDefault();let t=$("#topic-summary-editor-form").form("get values");E(),W(),$(".bookmark-header .topic-summary.selected").removeClass("selected summarized");let a=B(t);if(a){let e=z(a,t.topicValue);e&&delete e.summary,a.annotation.topicList.find(e=>e.summary)||(a.annotation.summarized=!1)}a.modified=!0,_(t.sid,"bookmark")}))}function G(){$("#activity-report").on("click",".cmi-manage-quote",(function(e){e.stopPropagation(),e.preventDefault();let t=Object(l.b)();if(!t)return;if($("#activity-report").hasClass("quote-editor-open"))return;$("#activity-report").addClass("quote-editor-open");let a={},o=$(this).text().trim(),[i,n,r]=o.substr(1).split(":"),s=$(this).prev("p").text().trim().replace(/\r?\n|\r/g," ");a.parakey=i,a.annotationId=n,a.pid=r,a.quote=s,a.userId=t.userId,a.url=Object(b.c)(i),a.citation=$(`#${n}`).text().trim(),$(this).append('\n    <form name="quote-editor" id="quote-editor-form" class="ui form">\n      <input class="hidden-field" type="text" readonly name="annotationId">\n      <input class="hidden-field" type="text" name="parakey" readonly>\n      <input class="hidden-field" type="text" name="pid" readonly>\n      <input class="hidden-field" type="text" name="userId" readonly>\n      <input class="hidden-field" type="text" name="url" readonly>\n      <input class="hidden-field" type="text" name="citation" readonly>\n      <div class="field">\n        <label>Edit Content for Display as a Quote</label>\n        <textarea name="quote" rows="5"></textarea>\n      </div>\n      <div class="field">\n        <label>Quote in Database</label>\n        <textarea name="database" readonly placeholder="Not in database." rows="5"></textarea>\n      </div>\n      <div class="fields">\n        <button class="quote-submit ui green button" type="submit">Add Quote</button>\n        <button class="quote-cancel ui red basic button">Cancel</button>\n        <div class="twelve wide field">\n          <button class="quote-delete ui red disabled right floated button">Delete</button>\n        </div>\n      </div>\n    </form>\n  '),async function(e){let t=$("#quote-editor-form");$("#quote-editor-form").addClass("loading");try{let a=await function(e,t,a){let o=`${w.a.user}/quoteData/${e}/${t}/${a}`;return new Promise((e,t)=>{C.a.get(o).then(t=>{e(t.data.quote)}).catch(e=>{t(e)})})}(e.userId,e.parakey,e.annotationId);a.q&&(e.database=a.q.quote,$("#quote-editor-form .quote-delete").removeClass("disabled"),$("#quote-editor-form button.quote-submit").text("Update Quote"),K(e.parakey,e.annotationId,!1)),$("#quote-editor-form").removeClass("loading"),t.form("set values",e)}catch(e){u.a.error(e),console.log("Error getting quote from database: %w",e)}}(a)})),$("#activity-report").on("click","#quote-editor-form .quote-submit",(async function(e){e.stopPropagation(),e.preventDefault();let t=$("#quote-editor-form").form("get values"),a=$(this).text().startsWith("Add")?"Added":"Updated",o={userId:t.userId,paraKey:t.parakey,creationDate:t.annotationId,quote:{pid:t.pid,quote:Object(p.a)(t.quote),url:t.url,citation:t.citation}};Q(),H();try{await function(e){let t=`${w.a.user}/quote`;return new Promise((a,o)=>{C.a.post(t,e).then(e=>{a(e.data.response)}).catch(e=>{o(e)})})}(o);u.a.info(`Quote ${a}`),K(t.parakey,t.annotationId)}catch(e){console.error("error posting quote to db: %o",e),u.a.error(e)}})),$("#activity-report").on("click","#quote-editor-form .quote-cancel",(function(e){e.stopPropagation(),e.preventDefault(),Q(),H()})),$("#activity-report").on("click","#quote-editor-form .quote-delete",(async function(e){e.stopPropagation(),e.preventDefault();let t=$("#quote-editor-form").form("get values");try{await function(e,t,a){let o=`${w.a.user}/quote/${e}/${t}/${a}`;return new Promise((e,t)=>{C.a.delete(o).then(t=>{e(t.data.response)}).catch(e=>{t(e)})})}(t.userId,t.parakey,t.annotationId);u.a.info("Quote deleted from database"),a=t.parakey,o=t.annotationId,U(a,o,!1),$(`.${o}`).removeClass("in-database")}catch(e){u.a.error(`failed to delete quote: ${e.message}`)}var a,o;Q(),H()}))}function E(){$("#topic-summary-editor-form").remove()}function W(){$("#activity-report").removeClass("topic-summary-editor-open")}function Q(){$("#quote-editor-form").remove()}function H(){$("#activity-report").removeClass("quote-editor-open")}function K(e,t,a=!0){a&&U(e,t,!0),$(`.${t}`).addClass("in-database")}function U(e,t,a){let o=A[e.substring(0,2)].find(a=>a.paraKey===e&&a.creationDate===t);o&&(o.modified=!0,o.quote=a,_(e.substring(0,2),"bookmark"))}function _(e,t){T[e]?T[e].hasOwnProperty(t)||(T[e][t]=!0):T[e]={[t]:!0},$("#applyChangesButtonNew").removeAttr("disabled")}function F(){if(!Object(l.b)())return u.a.warning("You must be signed in to edit your email list"),void setTimeout(()=>{location.href="/"},3e3);L(),G(),N(),window.onbeforeunload=function(e){var t;if("disabled"!==$("#applyChangesButtonNew").attr("disabled"))return t="Please click 'Apply' to save your changes.",void 0===e&&(e=window.event),e&&(e.returnValue=t),t}}$("button.source-select").on("click",(function(e){e.preventDefault();let t=$(this).attr("data-sid"),a=$(this).attr("class");a.includes("collapse")&&($(this).removeClass("collapse"),$(this).addClass("show-all"),$(this).text("Show All"),function(e){$("#sourceTable > tbody > tr").each((function(){$(this).attr("id")!==e&&$(this).addClass("hide")})),function(e){j(e),$(".annotation-actions").addClass("hide"),$("#action-manager").removeClass("hide")}(e)}(t)),a.includes("show-all")&&($(this).addClass("collapse"),$(this).removeClass("show-all"),$(this).text("Focus"),S("close"),P(),M(),$("#sourceTable > tbody > tr").each((function(){$(this).removeClass("hide")})),$("#action-manager").addClass("hide"),$("#manageTopicsButton").attr("disabled",""),$("#displayBookmarksButtonNew").attr("disabled",""),$("#topicTable").addClass("hide")),a.includes("bookmarks")&&function(e,t){$(t).addClass("loading"),function(e){let t=Object(l.b)();return new Promise((a,o)=>{let i=Object(y.a)(t.userId,e).then(t=>{q[e]=t,u.a.success(`${q[e].length} topics loaded`)}).catch(e=>{console.error("error fetching topicList: %s",e),u.a.error(e),o(e)}),n=Object(g.c)(t.userId,e).then(t=>{A[e]=t,A[e].forEach(e=>{e.modified=!1}),u.a.success(`${A[e].length} bookmarks loaded`)}).catch(e=>{console.error("error fetching bookmarks: %s",e),u.a.error(e),o(e)});Promise.all([i,n]).then(t=>{let o={topics:q[e].length,bookmarks:A[e].length};a(o)})})}(e).then(a=>{$(`#load-button-${e}`).html(`Topics: ${a.topics}<br>Annotations: ${a.bookmarks}`),$(t).removeClass("loading"),$("#action-manager").hasClass("hide")||j(e)}).catch(e=>{$(t).removeClass("loading")})}(t,this)}));var V=a(2),J=a(7);$(document).ready(()=>{Object(o.b)(J.a),Object(i.b)(),Object(V.c)(J.a),Object(n.a)("page"),r.a.initialize(),l.a.initialize(),s.a.initialize("transcript"),d.a.initialize(),1===$(".manage-email-list").length&&async function(){let e=Object(l.b)();if(!e)return u.a.warning("You must be signed in to edit your email list"),void setTimeout(()=>{location.href="/"},3e3);e.userId,$(".sync.icon").addClass("loading");try{f=await Object(m.a)(e.userId),$(".sync.icon.loading").removeClass("loading");let t=function(e){return`\n    ${e.map((e,t)=>`\n      <tr data-index="${t}">\n        <td class="delete-maillist-item"><i class="trash alternate icon"></i></td>\n        <td class="edit-maillist-item"><i class="pencil alternate icon"></i></td>\n        <td data-name="first">${e.first}</td>\n        <td data-name="last">${e.last}</td>\n        <td data-name="address">${e.address}</td>\n      </tr>\n    `).join("")}\n  `}(f);$("#email-list-table").html(t),v()}catch(e){$(".sync.icon.loading").removeClass("loading"),u.a.error(`Error getting email list: ${e}`)}}(),1===$(".manage-topic-list").length&&F()})}});